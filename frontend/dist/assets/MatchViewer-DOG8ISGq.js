import{d as ut,u as ht,l as A,y as bt,z as mt,o as T,c as z,a as s,g as Ne,w as Xe,b as ge,t as P,n as ve,j as Y,k as gt,e as se,T as vt,q as xe,i as xt,v as yt,F as Ye,s as De,I as wt,J as _t,x as oe,K as kt,C as Ge,D as Ve,_ as Ct}from"./index-CQ-O1ih4.js";import{_ as Mt}from"./BaseButton.vue_vue_type_script_setup_true_lang-DcsElT3k.js";import{u as St}from"./store-EHblqWf6.js";import{u as It}from"./store-DkukaYNA.js";const Tt={class:"relative z-10 flex flex-col sm:flex-row sm:items-center justify-between shrink-0 p-3 sm:p-4 border-b-4 border-amber-900/50 bg-slate-900/80 gap-3 sm:gap-4"},zt={class:"flex items-center gap-3 sm:gap-4 min-w-0"},Pt={class:"text-lg sm:text-2xl font-black tracking-tight text-amber-500 flex flex-wrap items-center gap-2 sm:gap-3 uppercase text-shadow-retro"},Et={key:0,class:"flex items-center gap-2 px-3 py-1 bg-black/60 border border-amber-500/50"},Ot={class:"relative z-10 flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 min-h-0 px-3 sm:px-4 pb-3 sm:pb-4 overflow-y-auto lg:overflow-hidden"},At={class:"lg:col-span-2 flex flex-col gap-3 sm:gap-4 min-h-0 min-w-0"},Rt={class:"relative flex-1 min-h-[45vh] sm:min-h-[55vh] border-4 border-slate-700 bg-[#020617] overflow-hidden shadow-2xl flex flex-col group pixel-box"},Lt={key:0,class:"absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm"},Nt={key:1,class:"absolute inset-0 z-10 flex items-center justify-center"},Xt={key:0,class:"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Yt={class:"max-w-md w-full text-center border-4 border-amber-500 bg-slate-900 p-6 shadow-2xl pixel-box animate-in zoom-in duration-300"},Dt=["src"],Gt={class:"mt-4 p-4 bg-slate-950/50 border-2 border-slate-800"},Vt={key:0,class:"flex flex-col gap-2"},jt={class:"flex items-center justify-between text-sm"},$t={class:"text-amber-400 font-bold"},Bt=["disabled"],Ht={key:1,class:"py-4"},Wt={class:"absolute bottom-0 inset-x-0 bg-slate-900/90 border-t-4 border-slate-700 p-3 sm:p-4 flex flex-col gap-3 transition-opacity duration-300 opacity-0 group-hover:opacity-100"},Ft={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-1 gap-3"},Ut={class:"flex items-center gap-3 sm:gap-4"},qt={key:0},Kt={key:1,class:"ml-1"},Zt={class:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},Jt={class:"text-xs font-mono text-amber-400 w-20 text-center font-bold"},Qt={class:"flex flex-wrap items-center gap-3 sm:gap-4"},es={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},ts={class:"w-8 text-right text-amber-200 font-mono font-bold"},ss={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},os={class:"w-10 text-center font-mono font-bold"},as={class:"flex flex-wrap items-center gap-3 sm:gap-6 px-4 sm:px-5 py-3 border-2 border-slate-700 bg-slate-900/80 text-xs text-slate-400 shadow-lg"},ls={class:"flex items-center gap-2.5"},ns=["src"],rs={class:"flex items-center gap-2.5"},is=["src"],ds={class:"flex flex-wrap items-center gap-4 sm:gap-6 font-mono text-[11px] tracking-wide"},cs={class:"flex flex-col items-center leading-none gap-1"},fs={class:"text-slate-200 font-bold text-sm"},ps={class:"flex flex-col items-center leading-none gap-1"},us={class:"text-emerald-400 font-bold text-sm"},hs={class:"flex flex-col items-center leading-none gap-1"},bs={class:"text-rose-400 font-bold text-sm"},ms={class:"border-4 border-slate-700 bg-slate-950 flex flex-col overflow-hidden min-h-0 shadow-xl pixel-box"},gs={class:"p-4 border-b-4 border-slate-800 bg-slate-900 flex items-center justify-between"},vs={class:"text-[10px] font-mono text-slate-400 bg-slate-950 px-2 py-1 border border-slate-700 font-bold"},xs=["id","onClick"],ys={key:0,class:"absolute left-0 top-0 bottom-0 w-1 bg-amber-500"},ws={class:"flex items-center justify-between mb-2 opacity-80 group-hover:opacity-100 pl-2"},_s={class:"font-bold text-amber-100 font-mono tracking-tight uppercase"},ks={key:0,class:"text-[10px] text-slate-500 font-bold"},Cs={class:"space-y-1.5 pl-2"},Ms={key:0,class:"flex items-baseline gap-1.5 flex-wrap leading-relaxed"},Ss={class:"text-emerald-400 font-bold"},Is={class:"text-rose-400 font-bold"},Ts={key:0,class:"text-[9px] text-slate-900 bg-amber-500 font-bold uppercase px-1"},zs={key:1,class:"flex items-center gap-2 p-1 bg-rose-950/30 border border-rose-900/50 mt-1"},Ps={class:"flex flex-col"},Es={class:"text-rose-300 font-bold"},Os={key:2,class:"text-emerald-500/60 italic text-[11px] font-bold"},je=64,ye=32,$e=24,As=ut({__name:"MatchViewer",setup(Rs){const V={BG_DUNGEON:"https://vibemedia.space/bg_dungeon_v2_99283.png?prompt=dark%20dungeon%20floor%20tile%20texture%20seamless&style=pixel_game_asset&key=NOGON",CHAR_HERO:"https://vibemedia.space/hero_knight_v2_88441.png?prompt=fantasy%20knight%20character%20sprite%20standing%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",CHAR_ENEMY:"https://vibemedia.space/enemy_slime_v2_99223.png?prompt=cute%20slime%20monster%20sprite%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",ICON_SWORD:"https://vibemedia.space/icon_sword_px_11223.png?prompt=pixel%20art%20sword%20icon&style=pixel_game_asset&key=NOGON",ICON_SKULL:"https://vibemedia.space/icon_skull_px_99887.png?prompt=pixel%20art%20skull%20icon&style=pixel_game_asset&key=NOGON",ICON_TROPHY:"https://vibemedia.space/trophy_icon_4d5e6f_v1.png?prompt=golden%20trophy%20pixel%20art&style=pixel_game_asset&key=NOGON",TEX_FLOOR:"https://vibemedia.space/floor_cobble_7a8b9c_v1.png?prompt=cobblestone%20texture%20with%20worn%20stones%20and%20dirt%20between%20cracks&style=pixel_game_asset&key=NOGON",TEX_WALL:"https://vibemedia.space/wall_stone_1x2y3z_v1.png?prompt=stone%20brick%20texture%20with%20weathered%20gray%20surface%20and%20moss%20details&style=pixel_game_asset&key=NOGON"},K=ht(),we=St(),j=It(),Be=wt(),H=A(Be.params.id),R=A(null),D=A([]),ae=A(!1);let W=null;const le=A(null),F=A({}),ne={},_e=A(!1),He=()=>{let e=0;const t=Object.keys(V).length;Object.entries(V).forEach(([o,a])=>{const i=new Image;i.src=a,i.onload=()=>{e++,e===t&&(_e.value=!0)},ne[o]=i})},d=_t({x:0,y:0,zoom:1,shakeX:0,shakeY:0,isDragging:!1,lastX:0,lastY:0}),re=A([]),C=A(0),L=A(!1),U=A(1);let N=0,Z=null;const J=A(null),G=(e,t)=>{if(!(!e||typeof e!="object"))return e[t]},Q=e=>typeof e!="string"?"--":e.substring(0,6),We=oe(()=>R.value==="running"?"bg-amber-950 text-amber-500 border-amber-700":R.value==="completed"?"bg-slate-950 text-slate-500 border-slate-700":"bg-emerald-950 text-emerald-500 border-emerald-700"),k=oe(()=>D.value.map(e=>e.round)),ke=oe(()=>k.value.length?(k.value.indexOf(C.value)+1)/k.value.length*100:0),ie=oe(()=>{const e=F.value[C.value];if(!e)return{total:0,alive:0,fallen:0};const t=Object.values(e.entities);return{total:t.length,alive:t.filter(o=>o.alive).length,fallen:t.filter(o=>!o.alive).length}}),Fe=(e,t)=>{const o=(e-t)*je*.5,a=(e+t)*ye*.5;return{x:o,y:a}},$=(e,t,o,a)=>{const i=Fe(e,t),c=o/2,l=a/4;return{x:c+i.x*d.zoom+d.x+d.shakeX,y:l+i.y*d.zoom+d.y+d.shakeY}},Ue=e=>{d.shakeX=(Math.random()-.5)*e,d.shakeY=(Math.random()-.5)*e},qe=e=>{d.isDragging=!0,d.lastX=e.clientX,d.lastY=e.clientY},Ke=e=>{if(!d.isDragging)return;const t=e.clientX-d.lastX,o=e.clientY-d.lastY;d.x+=t,d.y+=o,d.lastX=e.clientX,d.lastY=e.clientY},Ce=()=>{d.isDragging=!1},Ze=e=>{const t=-Math.sign(e.deltaY)*.1;de(t)},de=e=>{d.zoom=Math.max(.2,Math.min(3,d.zoom+e))},ce={top:"#1e293b",side:"#0f172a",stroke:"#334155"},Je=(e,t,o,a,i,c)=>{const l=$(t,o,a,i),r=d.zoom,f=je*r,n=ye*r,M=(Math.sin(t*.5)+Math.cos(o*.5))*2*r,h=l.y-M,b=8*r;e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x+f/2,h+n/2+b),e.lineTo(l.x,h+n+b),e.fillStyle=ce.side,e.fill(),e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.lineTo(l.x-f/2,h+n/2+b),e.lineTo(l.x,h+n+b),e.fillStyle="#020617",e.fill(),e.beginPath(),e.moveTo(l.x,h),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.closePath(),e.save(),e.clip(),_e.value&&ne.TEX_FLOOR?(e.drawImage(ne.TEX_FLOOR,l.x-f/2,h,f,n),e.fillStyle="rgba(30, 41, 59, 0.4)",e.fill()):(e.fillStyle=ce.top,e.fill()),(t+o*7)%5===0&&(e.fillStyle="rgba(255, 255, 255, 0.1)",e.fill()),e.restore(),e.strokeStyle=ce.stroke,e.lineWidth=1*r,e.stroke()},fe=(e,t,o)=>{const a=Math.cos(o),i=Math.sin(o);return{x:e*a-t*i,y:e*i+t*a}},pe=(e,t)=>{const o=parseInt(e.slice(1),16),a=t<0?0:255,i=t<0?t*-1:t,c=o>>16,l=o>>8&255,r=o&255;return"#"+(16777216+(Math.round((a-c)*i)+c)*65536+(Math.round((a-l)*i)+l)*256+(Math.round((a-r)*i)+r)).toString(16).slice(1)},Qe=(e,t,o,a,i,c,l,r,f,n,M,h)=>{const b=i/2,m=c/2,p=[{x:b,y:m},{x:-b,y:m},{x:-b,y:-m},{x:b,y:-m}],w=p.map(x=>{const E=fe(x.x,x.y,r);return{x:t+E.x,y:o+E.y,z:a+l}}),S=p.map(x=>{const E=fe(x.x,x.y,r);return{x:t+E.x,y:o+E.y,z:a}}),v=x=>{const E=$(x.x,x.y,M,h);return{x:E.x,y:E.y-x.z*ye*n}},u=w.map(v),y=S.map(v);e.fillStyle=pe(f,.1),e.beginPath(),e.moveTo(u[0].x,u[0].y);for(let x=1;x<4;x++)e.lineTo(u[x].x,u[x].y);e.closePath(),e.fill(),e.strokeStyle=pe(f,-.2),e.lineWidth=1,e.stroke();let g=0,_=u[0].y;for(let x=1;x<4;x++)u[x].y>_&&(_=u[x].y,g=x);const O=(x,E,B)=>{e.fillStyle=pe(f,B),e.beginPath(),e.moveTo(u[x].x,u[x].y),e.lineTo(u[E].x,u[E].y),e.lineTo(y[E].x,y[E].y),e.lineTo(y[x].x,y[x].y),e.closePath(),e.fill(),e.stroke()};O(g,(g+1)%4,-.3),O(g,(g+3)%4,-.1)},et=(e,t,o,a,i,c,l,r,f,n,M,h,b)=>{const m=i?{head:"#fbbf24",body:"#3b82f6",leg:"#1e3a8a",arm:"#93c5fd"}:{head:"#4ade80",body:"#166534",leg:"#14532d",arm:"#86efac"};b&&(m.head="#ffffff",m.body="#ffffff",m.leg="#ffffff",m.arm="#ffffff");const w=c?Math.sin(n*.01):0,S=w*.5;let v=-w*.5,u=w*.5;if(l){const I=Math.sin(n*.03);u=-Math.PI/2+I*.5}const y=0+a*.01,g=[],_=.25,O=.25,x=.12,E=.3,B=.08,te=.08,X=.3,ue=y+X;g.push({cx:0,cy:0,cz:ue,w:O,d:x,h:E,offsetVec:{x:0,y:0,z:0},color:m.body}),g.push({cx:0,cy:0,cz:ue+E,w:_,d:_,h:_,offsetVec:{x:0,y:0,z:Math.sin(n*.002)*.02},color:m.head});const Pe=.06;g.push({cx:0,cy:Pe,cz:y,w:B,d:te,h:X,offsetVec:{x:Math.sin(S)*.1,y:0,z:0},color:m.leg}),g.push({cx:0,cy:-Pe,cz:y,w:B,d:te,h:X,offsetVec:{x:Math.sin(-S)*.1,y:0,z:0},color:m.leg});const he=ue+E-.05,be=.16;if(g.push({cx:0,cy:be,cz:he-X,w:B,d:te,h:X,offsetVec:{x:Math.sin(v)*.1,y:0,z:Math.cos(v)*.1-.1},color:m.arm}),g.push({cx:0,cy:-be,cz:he-X,w:B,d:te,h:X,offsetVec:{x:Math.sin(u)*.2,y:0,z:Math.cos(u)*.1-.1},color:m.arm}),l){const q=Math.sin(u)*.2,me=he-X+Math.cos(u)*.1-.1;g.push({cx:.1,cy:-be-.05,cz:me,w:.4,d:.05,h:.05,offsetVec:{x:q+.2,y:0,z:0},color:"#cbd5e1"})}const Ee=g.map(I=>{let q=I.cx+I.offsetVec.x,me=I.cy+I.offsetVec.y,Oe=I.cz+I.offsetVec.z;const Ae=fe(q,me,r),Re=t+Ae.x,Le=o+Ae.y,pt=Re+Le+Oe*.1;return{...I,wx:Re,wy:Le,wz:Oe,depth:pt}});Ee.sort((I,q)=>I.depth-q.depth),Ee.forEach(I=>{Qe(e,I.wx,I.wy,I.wz,I.w,I.d,I.h,r,I.color,f,M,h)})},tt=(e,t,o,a,i,c,l,r)=>{const f=$(o,a,i,c),n=d.zoom;if(!t.alive){e.fillStyle="#334155";const _=10*n;e.beginPath(),e.rect(f.x-_/2,f.y,_,_),e.fill();return}const M=Math.sin(l/300+t.floatOffset)*2*n,h=r?.hit?(Math.random()-.5)*5*n:0,b=f.y-12*n+M,m=f.x+h;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(f.x,f.y+14*n,10*n,5*n,0,0,Math.PI*2),e.fill();const p=t.isMoving||!1;let w=0;(t.vx!=null||t.vy!=null)&&(w=Math.atan2(t.vy??0,t.vx??0)),et(e,o,a,M,t.isPlayer,p,r?.attacking||!1,w,n,l,i,c,r?.hit);const S=Math.max(0,t.hp/t.maxHp),v=24*n,u=4*n,y=m-v/2,g=b-50*n;e.fillStyle="#000",e.fillRect(y-1,g-1,v+2,u+2),e.fillStyle=S>.5?"#10b981":S>.25?"#f59e0b":"#ef4444",e.fillRect(y,g,v*S,u)},st=(e,t,o,a)=>{for(let i=re.value.length-1;i>=0;i--){const c=re.value[i];if(c.life-=a,c.life<=0){re.value.splice(i,1);continue}c.x+=c.vx*a*.06,c.y+=c.vy*a*.06,c.z+=c.vz*a*.06,c.vz-=.02,c.z<0&&(c.z=0,c.vx*=.5,c.vy*=.5);const l=$(c.x,c.y,t,o),r=d.zoom,f=l.y-c.z*10*r;e.fillStyle=c.color;const n=Math.max(2,c.size*r);e.fillRect(l.x-n/2,f-n/2,n,n)}},ot=(e,t,o,a,i)=>{for(const l of t.events.attacks){const r=t.entities[l.attackerId],f=t.entities[l.targetId];if(!r||!f)continue;const n=$(r.x,r.y,o,a),M=$(f.x,f.y,o,a);n.y-=30*d.zoom,M.y-=30*d.zoom;const h=l.isCritical;if(i<.5){const b=i/.5,m=n.x+(M.x-n.x)*b,p=n.y+(M.y-n.y)*b,w=Math.sin(b*Math.PI)*40*d.zoom,S=8*d.zoom,v=m,u=p-w,y=e.createRadialGradient(v-S/3,u-S/3,S/6,v,u,S*1.2);h?(y.addColorStop(0,"#ffffff"),y.addColorStop(.2,"#fef3c7"),y.addColorStop(.5,"#fbbf24"),y.addColorStop(.8,"#d97706"),y.addColorStop(1,"rgba(180, 83, 9, 0)")):(y.addColorStop(0,"#ffffff"),y.addColorStop(.2,"#dbeafe"),y.addColorStop(.5,"#60a5fa"),y.addColorStop(.8,"#2563eb"),y.addColorStop(1,"rgba(30, 64, 175, 0)")),e.save(),e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=15*d.zoom,e.fillStyle=y,e.beginPath(),e.arc(v,u,S,0,Math.PI*2),e.fill(),e.restore();const g=e.createRadialGradient(v,u,0,v,u,S*.4);if(g.addColorStop(0,"rgba(255, 255, 255, 0.9)"),g.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=g,e.beginPath(),e.arc(v,u,S*.4,0,Math.PI*2),e.fill(),b>.1){const _=e.createLinearGradient(n.x,n.y,v,u);h?(_.addColorStop(0,"rgba(251, 191, 36, 0)"),_.addColorStop(.5,"rgba(251, 191, 36, 0.3)"),_.addColorStop(1,"rgba(251, 191, 36, 0.8)")):(_.addColorStop(0,"rgba(96, 165, 250, 0)"),_.addColorStop(.5,"rgba(96, 165, 250, 0.3)"),_.addColorStop(1,"rgba(96, 165, 250, 0.8)")),e.strokeStyle=_,e.lineWidth=3*d.zoom,e.lineCap="round",e.beginPath(),e.moveTo(n.x,n.y),e.quadraticCurveTo(n.x+(M.x-n.x)*.5,n.y+(M.y-n.y)*.5-40*d.zoom,v,u),e.stroke()}}if(i>=.5&&i<.5+.3){const b=(i-.5)/.3,m=M.x,p=M.y-20*d.zoom,w=(h?30:20)*d.zoom*(.3+b*.7),S=1-b;e.save(),e.globalAlpha=S;const v=e.createRadialGradient(m,p,w*.5,m,p,w);if(h?(v.addColorStop(0,"rgba(251, 191, 36, 0)"),v.addColorStop(.6,"rgba(251, 191, 36, 0.8)"),v.addColorStop(.8,"rgba(245, 158, 11, 0.6)"),v.addColorStop(1,"rgba(217, 119, 6, 0)")):(v.addColorStop(0,"rgba(96, 165, 250, 0)"),v.addColorStop(.6,"rgba(96, 165, 250, 0.8)"),v.addColorStop(.8,"rgba(59, 130, 246, 0.6)"),v.addColorStop(1,"rgba(37, 99, 235, 0)")),e.fillStyle=v,e.beginPath(),e.arc(m,p,w,0,Math.PI*2),e.fill(),b<.5){const g=1-b/.5,_=(h?15:10)*d.zoom*(1-b*.5);e.globalAlpha=g,e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=20*d.zoom;const O=e.createRadialGradient(m,p,0,m,p,_);O.addColorStop(0,"#ffffff"),O.addColorStop(.5,h?"#fef3c7":"#dbeafe"),O.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=O,e.beginPath(),e.arc(m,p,_,0,Math.PI*2),e.fill()}const u=h?8:5,y=(h?25:15)*d.zoom*(.5+b*.5);e.globalAlpha=S*.8,e.strokeStyle=h?"#fef3c7":"#dbeafe",e.lineWidth=2*d.zoom,e.lineCap="round";for(let g=0;g<u;g++){const _=Math.PI*2/u*g+b*.5,O=w*.3,x=O+y*(1-b*.5);e.beginPath(),e.moveTo(m+Math.cos(_)*O,p+Math.sin(_)*O),e.lineTo(m+Math.cos(_)*x,p+Math.sin(_)*x),e.stroke()}e.restore()}if(i>=.5){const b=(i-.5)/.5,m=Math.min(1,b*3),w=(1-Math.pow(1-m,3))*60*d.zoom,S=Math.max(0,1-b*1.5);e.save(),e.globalAlpha=S;const v=Math.round((l.isCritical?24:14)*d.zoom);e.font=`bold ${v}px 'Courier New', monospace`,e.textAlign="center";const u=`${l.damage}`,y=M.x,g=M.y-30*d.zoom-w;e.lineWidth=3,e.strokeStyle="black",e.strokeText(u,y,g),e.fillStyle=l.isCritical?"#fbbf24":"#fff",e.fillText(u,y,g),l.isCritical&&(e.font=`bold ${Math.round(10*d.zoom)}px 'Courier New', monospace`,e.fillStyle="#f59e0b",e.fillText("CRIT!",y,g-20*d.zoom)),e.restore()}}},at=e=>{if(!le.value)return;const t=le.value,o=t.getContext("2d");if(!o)return;const a=t.getBoundingClientRect();(t.width!==a.width||t.height!==a.height)&&(t.width=a.width,t.height=a.height),d.shakeX*=.9,d.shakeY*=.9,Math.abs(d.shakeX)<.5&&(d.shakeX=0),Math.abs(d.shakeY)<.5&&(d.shakeY=0);let i=C.value,c=0;if(L.value&&N>0){const p=1e3/U.value;c=Math.min(1,(e-N)/p)}const l=F.value[i];if(!l)return;const r=k.value.indexOf(i)+1,f=k.value[r],n=f?F.value[f]:void 0;o.clearRect(0,0,t.width,t.height);for(let p=0;p<=$e;p++)for(let w=0;w<=$e;w++)Je(o,p,w,t.width,t.height);const M=lt(l,n,c),h=new Set,b=new Set;l.events?.attacks&&(c>=.5&&c<.5+.2&&l.events.attacks.forEach(w=>h.add(w.targetId)),c<.4&&l.events.attacks.forEach(w=>b.add(w.attackerId)));const m=Object.values(M).map(p=>({type:"entity",yDepth:p.x+p.y,entity:p,x:p.x,y:p.y,hit:h.has(p.id),attacking:b.has(p.id)}));m.sort((p,w)=>p.yDepth-w.yDepth);for(const p of m)p.type==="entity"&&tt(o,p.entity,p.x,p.y,t.width,t.height,e,{hit:p.hit,attacking:p.attacking});st(o,t.width,t.height,16),ot(o,l,t.width,t.height,c)},lt=(e,t,o)=>{if(!t||o<=0)return e.entities;const a={};return new Set([...Object.keys(e.entities),...Object.keys(t.entities)]).forEach(c=>{const l=e.entities[c],r=t.entities[c];if(l&&r){const f=r.x-l.x,n=r.y-l.y,M=o<1&&(Math.abs(f)>.001||Math.abs(n)>.001);a[c]={...l,x:l.x+f*o,y:l.y+n*o,hp:l.hp+(r.hp-l.hp)*o,alive:o<.8?l.alive:r.alive,floatOffset:l.floatOffset,vx:f,vy:n,isMoving:M}}else r?a[c]={...r,isMoving:!1,vx:0,vy:0}:l&&(a[c]={...l,isMoving:!1,vx:0,vy:0})}),a},Me=e=>{if(at(e),L.value){N||(N=e);const t=1e3/U.value,o=(e-N)/t;if(o>.1&&o<.15&&F.value[C.value]?.events.attacks.some(i=>i.isCritical)&&Ue(2*d.zoom),o>=1){const i=k.value.indexOf(C.value)+1;i>=k.value.length?(L.value=!1,N=0):(C.value=k.value[i],N=e,ee(C.value))}}Z=requestAnimationFrame(Me)},Se=e=>{const t=k.value.indexOf(C.value);if(t===-1)return;const o=t+e;o<0||o>=k.value.length||(C.value=k.value[o],ee(C.value))},ee=e=>{kt(()=>{const t=document.getElementById("log-round-"+e);if(t&&J.value){const o=t.offsetTop-J.value.offsetTop;J.value.scrollTo({top:o-100,behavior:"smooth"})}})},nt=e=>{if(!k.value.length)return;const t=e.currentTarget.getBoundingClientRect(),o=e.clientX-t.left,a=Math.max(0,Math.min(1,o/t.width)),i=Math.floor(a*(k.value.length-1));C.value=k.value[i],ee(C.value)},rt=e=>{C.value=e,L.value=!1},it=()=>{k.value.length<=1||(L.value?L.value=!1:(C.value===k.value[k.value.length-1]&&(C.value=k.value[0]),L.value=!0,N=0))},dt=async()=>{try{await j.claimAll(),window.location.href="/matches"}catch(e){console.error("Failed to claim rewards:",e)}},Ie=async()=>{if(!(!K.token||!H.value)){ae.value=!0;try{const t=await Ge(`${Ve.match}/${H.value}/roundticks`,{token:K.token})||[],o=D.value.length;if(D.value=t,ct(),R.value==="running"&&t.length>o&&t.length>0){const a=t[t.length-1]?.round;a!=null&&(C.value=a,ee(a))}}catch(e){console.error(e)}finally{ae.value=!1}}},Te=async()=>{if(!(!K.token||!H.value))try{const e=await Ge(`${Ve.match}/${H.value}`,{token:K.token});return R.value=e?.status??null,e?.status}catch{return R.value=null,null}},ct=()=>{const e=new Set(we.fighters.map(a=>a.id)),t=new Map,o={};for(const a of D.value){const i={attacks:[],deaths:[]};for(const l of a.ticks||[]){const r=l.payload;if(r){if(l.type==="spawn"){const f=r.fighterId;t.set(f,{id:f,x:r.x??0,y:r.y??0,hp:r.hp??100,maxHp:r.hp??100,alive:!0,isPlayer:e.has(f),floatOffset:Math.random()*Math.PI*2})}else if(l.type==="move"){const f=r.fighterId,n=t.get(f);n&&(n.x=r.toX??n.x,n.y=r.toY??n.y)}else if(l.type==="attack"){i.attacks.push({attackerId:r.attackerId,targetId:r.targetId,isCritical:r.isCritical,isParried:r.isParried,damage:r.damage});const f=t.get(r.targetId);f&&(f.hp=Math.max(0,f.hp-(r.damage||0)))}else if(l.type==="died"){const f=r.fighterId,n=t.get(f);n&&(n.alive=!1,n.hp=0),i.deaths.push(f)}}}const c={};t.forEach((l,r)=>{c[r]={...l}}),o[a.round]={round:a.round,entities:c,events:i}}F.value=o};function ft(){W||(W=window.setInterval(async()=>{const e=await Te();await Ie(),e==="completed"&&ze()},2500))}function ze(){W&&(clearInterval(W),W=null)}return bt(async()=>{await we.fetchFighters(),await j.fetchRewards(),He(),await Te(),await Ie(),k.value.length&&(R.value==="completed"?C.value=k.value[0]:C.value=k.value[k.value.length-1]),Z=requestAnimationFrame(Me),R.value==="running"&&ft()}),mt(()=>{Z&&cancelAnimationFrame(Z),ze()}),(e,t)=>(T(),z("div",{class:"pixel-theme h-dvh max-h-dvh overflow-hidden flex flex-col gap-3 sm:gap-4 font-mono text-slate-200",style:xe({backgroundImage:`url('${V.BG_DUNGEON}')`})},[t[32]||(t[32]=s("div",{class:"fixed inset-0 bg-slate-950/80 pointer-events-none z-0"},null,-1)),s("header",Tt,[s("div",zt,[Ne(Mt,{variant:"ghost",size:"sm",onClick:t[0]||(t[0]=o=>e.$router.push("/matches")),"class-name":"rpg-btn-small"},{default:Xe(()=>[...t[7]||(t[7]=[ge(" ← BACK ",-1)])]),_:1}),s("div",null,[s("h1",Pt,[ge(" BATTLE LOG #"+P(H.value?.substring(0,8))+" ",1),R.value?(T(),z("span",{key:0,class:ve(["px-2 py-0.5 text-xs font-bold uppercase tracking-wider border-2",We.value])},P(R.value),3)):Y("",!0)])])]),R.value==="running"?(T(),z("div",Et,[...t[8]||(t[8]=[s("span",{class:"relative flex h-2 w-2"},[s("span",{class:"animate-ping absolute inline-flex h-full w-full bg-amber-400 opacity-75"}),s("span",{class:"relative inline-flex h-2 w-2 bg-amber-500"})],-1),s("span",{class:"text-xs font-bold text-amber-400 uppercase tracking-widest blink"},"LIVE FEED",-1)])])):Y("",!0)]),s("div",Ot,[s("div",At,[s("div",Rt,[ae.value?(T(),z("div",Lt,[...t[9]||(t[9]=[s("div",{class:"flex flex-col items-center gap-3"},[s("div",{class:"h-8 w-8 animate-spin border-4 border-amber-500 border-t-transparent"}),s("p",{class:"text-amber-200 text-sm font-bold uppercase tracking-wider"},"Loading battle data...")],-1)])])):D.value.length?Y("",!0):(T(),z("div",Nt,[...t[10]||(t[10]=[s("p",{class:"text-slate-500 font-bold uppercase tracking-wider"},"Waiting for battle data...",-1)])])),s("canvas",{ref_key:"canvasRef",ref:le,class:"w-full h-full object-cover cursor-move pixelated",onMousedown:qe,onMousemove:Ke,onMouseup:Ce,onMouseleave:Ce,onWheel:gt(Ze,["prevent"])},null,544),t[17]||(t[17]=s("div",{class:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"},null,-1)),t[18]||(t[18]=s("div",{class:"absolute inset-0 pointer-events-none opacity-10 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-size-[100%_4px]"},null,-1)),Ne(vt,{name:"fade"},{default:Xe(()=>[R.value==="completed"&&k.value.length&&C.value===k.value[k.value.length-1]?(T(),z("div",Xt,[s("div",Yt,[s("img",{src:V.ICON_TROPHY,class:"w-16 h-16 mx-auto mb-2 pixelated animate-bounce-slow"},null,8,Dt),t[14]||(t[14]=s("h2",{class:"text-3xl font-black text-amber-500 tracking-widest uppercase text-shadow-retro"},"BATTLE ENDED",-1)),s("div",Gt,[t[13]||(t[13]=s("h3",{class:"text-xs font-bold text-slate-500 uppercase mb-3 text-shadow-retro"},"Rewards available to claim",-1)),se(j).rewardCount>0?(T(),z("div",Vt,[s("div",jt,[t[11]||(t[11]=s("span",{class:"text-slate-400"},"Match Bonus:",-1)),s("span",$t,"+ "+P(se(j).rewardCount*20)+" Particles",1)]),s("button",{class:"rpg-btn-small mt-2 w-full !bg-amber-600 !text-slate-900 border-amber-800 hover:!bg-amber-500 font-bold",onClick:dt,disabled:se(j).isLoading},P(se(j).isLoading?"CLAIMING...":"CLAIM & EXIT"),9,Bt)])):(T(),z("div",Ht,[t[12]||(t[12]=s("p",{class:"text-slate-500 text-xs italic"},"All rewards claimed or none earned.",-1)),s("button",{class:"rpg-btn-small mt-3 w-full font-bold",onClick:t[1]||(t[1]=o=>e.$router.push("/matches"))},"EXIT TO MAP")]))])])])):Y("",!0)]),_:1}),s("div",Wt,[s("div",{class:"relative h-4 bg-slate-950 border-2 border-slate-700 cursor-pointer group/bar",onClick:nt},[s("div",{class:"absolute inset-y-0 left-0 bg-amber-600 transition-all duration-100",style:xe({width:ke.value+"%"})},null,4),s("div",{class:"absolute inset-y-0 w-2 bg-white opacity-0 group-hover/bar:opacity-100 transition-opacity",style:xe({left:ke.value+"%"})},null,4)]),s("div",Ft,[s("div",Ut,[s("button",{onClick:it,class:"rpg-btn-small bg-amber-600 border-amber-800 text-slate-900 hover:bg-amber-500 font-black h-10 w-10 flex items-center justify-center"},[L.value?(T(),z("span",qt,"||")):(T(),z("span",Kt,">"))]),s("div",Zt,[s("button",{onClick:t[2]||(t[2]=o=>Se(-1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},"<<"),s("span",Jt,"RND "+P(C.value),1),s("button",{onClick:t[3]||(t[3]=o=>Se(1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},">>")])]),s("div",Qt,[s("div",es,[t[15]||(t[15]=s("span",{class:"uppercase font-bold"},"SPD",-1)),xt(s("input",{type:"range",min:"0.5",max:"4",step:"0.5","onUpdate:modelValue":t[4]||(t[4]=o=>U.value=o),class:"w-20 accent-amber-500 h-2 bg-slate-800 appearance-none cursor-pointer"},null,512),[[yt,U.value,void 0,{number:!0}]]),s("span",ts,P(U.value)+"x",1)]),s("div",ss,[t[16]||(t[16]=s("span",{class:"uppercase font-bold"},"ZM",-1)),s("button",{onClick:t[5]||(t[5]=o=>de(-.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"-"),s("span",os,P(Math.round(d.zoom*100))+"%",1),s("button",{onClick:t[6]||(t[6]=o=>de(.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"+")])])])])]),s("div",as,[s("div",ls,[s("img",{src:V.ICON_SWORD,class:"w-4 h-4 pixelated"},null,8,ns),t[19]||(t[19]=s("span",{class:"font-bold text-emerald-200 uppercase"},"Heroes",-1))]),s("div",rs,[s("img",{src:V.ICON_SKULL,class:"w-4 h-4 pixelated"},null,8,is),t[20]||(t[20]=s("span",{class:"font-bold text-rose-200 uppercase"},"Enemies",-1))]),t[26]||(t[26]=s("div",{class:"flex-1 hidden sm:block"},null,-1)),s("div",ds,[s("div",cs,[t[21]||(t[21]=s("span",{class:"text-slate-500 font-bold uppercase"},"TOTAL",-1)),s("span",fs,P(ie.value.total),1)]),t[24]||(t[24]=s("div",{class:"w-px h-6 bg-slate-700"},null,-1)),s("div",ps,[t[22]||(t[22]=s("span",{class:"text-emerald-500/70 font-bold uppercase"},"ALIVE",-1)),s("span",us,P(ie.value.alive),1)]),t[25]||(t[25]=s("div",{class:"w-px h-6 bg-slate-700"},null,-1)),s("div",hs,[t[23]||(t[23]=s("span",{class:"text-rose-500/70 font-bold uppercase"},"FALLEN",-1)),s("span",bs,P(ie.value.fallen),1)])])])]),s("div",ms,[s("div",gs,[t[27]||(t[27]=s("h3",{class:"font-bold text-amber-500 text-sm uppercase tracking-wider flex items-center gap-2"},[s("span",{class:"w-2 h-2 bg-amber-500 animate-pulse"}),ge(" Combat Log ")],-1)),s("span",vs,P(D.value.length)+" TICKS",1)]),s("div",{class:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar scroll-smooth bg-[#020617]",ref_key:"logsContainer",ref:J},[(T(!0),z(Ye,null,De(D.value,o=>(T(),z("div",{key:o.round,id:"log-round-"+o.round,onClick:a=>rt(o.round),class:ve(["border-2 p-3 text-xs transition-all cursor-pointer group relative overflow-hidden",o.round===C.value?"border-amber-600 bg-amber-900/20":"border-slate-800 hover:border-slate-600 hover:bg-slate-900"])},[o.round===C.value?(T(),z("div",ys)):Y("",!0),s("div",ws,[s("span",_s,"ROUND "+P(o.round.toString().padStart(2,"0")),1),o.ticks?.length?(T(),z("span",ks,P(o.ticks.length)+" EVENTS",1)):Y("",!0)]),s("div",Cs,[(T(!0),z(Ye,null,De(o.ticks,(a,i)=>(T(),z("div",{key:i,class:"pl-3 border-l-2 border-slate-800 py-0.5 relative"},[t[31]||(t[31]=s("div",{class:"absolute -left-[5px] top-2 w-[8px] h-[8px] bg-slate-800 border border-slate-600 rotate-45"},null,-1)),a.type==="attack"?(T(),z("div",Ms,[s("span",Ss,P(Q(G(a.payload,"attackerId"))),1),t[28]||(t[28]=s("span",{class:"text-slate-600 text-[10px] uppercase font-bold tracking-wider"},"HIT",-1)),s("span",Is,P(Q(G(a.payload,"targetId"))),1),s("span",{class:ve(["font-mono font-bold ml-1",G(a.payload,"isCritical")?"text-amber-400 text-sm":"text-slate-300"])}," -"+P(G(a.payload,"damage")),3),G(a.payload,"isCritical")?(T(),z("span",Ts,"CRIT")):Y("",!0)])):a.type==="died"?(T(),z("div",zs,[t[30]||(t[30]=s("span",{class:"text-rose-500 text-lg"},"☠",-1)),s("div",Ps,[t[29]||(t[29]=s("span",{class:"text-rose-500 font-bold uppercase text-[10px] tracking-wide"},"SLAIN",-1)),s("span",Es,P(Q(G(a.payload,"fighterId"))),1)])])):a.type==="spawn"?(T(),z("div",Os," ✨ "+P(Q(G(a.payload,"fighterId")))+" APPEARED ",1)):Y("",!0)]))),128))])],10,xs))),128))],512)])])],4))}}),Ds=Ct(As,[["__scopeId","data-v-dbd881eb"]]);export{Ds as default};
