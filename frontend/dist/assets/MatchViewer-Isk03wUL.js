import{d as mt,u as ht,l as L,y as bt,z as gt,o as _,c as w,a as s,g as Ye,w as Xe,b as _e,t as C,n as de,j as D,k as vt,e as ce,T as yt,q as we,i as xt,v as _t,F as De,s as Ge,I as wt,J as kt,x as se,K as Mt,C as He,D as Ve,_ as Ct}from"./index-DdJYqMmv.js";import{_ as It}from"./BaseButton.vue_vue_type_script_setup_true_lang-CNHnN6jv.js";import{u as St}from"./store-dBYPAPHw.js";import{u as Tt}from"./store-B7xitLsl.js";const zt={class:"relative z-10 flex flex-col sm:flex-row sm:items-center justify-between shrink-0 p-3 sm:p-4 border-b-4 border-amber-900/50 bg-slate-900/80 gap-3 sm:gap-4"},Et={class:"flex items-center gap-3 sm:gap-4 min-w-0"},Pt={class:"text-lg sm:text-2xl font-black tracking-tight text-amber-500 flex flex-wrap items-center gap-2 sm:gap-3 uppercase text-shadow-retro"},Ot={key:0,class:"flex items-center gap-2 px-3 py-1 bg-black/60 border border-amber-500/50"},At={class:"relative z-10 flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 min-h-0 px-3 sm:px-4 pb-3 sm:pb-4 overflow-y-auto lg:overflow-hidden"},Rt={class:"lg:col-span-2 flex flex-col gap-3 sm:gap-4 min-h-0 min-w-0"},Nt={class:"relative flex-1 min-h-[45vh] sm:min-h-[55vh] border-4 border-slate-700 bg-[#020617] overflow-hidden shadow-2xl flex flex-col group pixel-box"},Lt={key:0,class:"absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm"},Yt={key:1,class:"absolute inset-0 z-10 flex items-center justify-center"},Xt={key:0,class:"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Dt={class:"max-w-md w-full text-center border-4 border-amber-500 bg-slate-900 p-6 shadow-2xl pixel-box animate-in zoom-in duration-300"},Gt=["src"],Ht=["src"],Vt={key:2,class:"text-3xl font-black text-amber-500 tracking-widest uppercase text-shadow-retro"},Bt={key:3,class:"text-3xl font-black text-rose-500 tracking-widest uppercase text-shadow-retro"},jt={class:"mt-4 p-4 bg-slate-950/50 border-2 border-slate-800"},$t={key:0,class:"flex flex-col gap-2"},Wt={class:"flex items-center justify-between text-sm"},Ft={class:"text-amber-400 font-bold"},Ut=["disabled"],Kt={key:1,class:"py-4"},qt={class:"absolute bottom-0 inset-x-0 bg-slate-900/90 border-t-4 border-slate-700 p-3 sm:p-4 flex flex-col gap-3 transition-opacity duration-300 opacity-0 group-hover:opacity-100"},Zt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-1 gap-3"},Jt={class:"flex items-center gap-3 sm:gap-4"},Qt={key:0},es={key:1,class:"ml-1"},ts={class:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},ss={class:"text-xs font-mono text-amber-400 w-20 text-center font-bold"},os={class:"flex flex-wrap items-center gap-3 sm:gap-4"},as={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},ls={class:"w-8 text-right text-amber-200 font-mono font-bold"},ns={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},rs={class:"w-10 text-center font-mono font-bold"},is={class:"flex flex-wrap items-center gap-3 sm:gap-6 px-4 sm:px-5 py-3 border-2 border-slate-700 bg-slate-900/80 text-xs text-slate-400 shadow-lg"},ds={class:"flex items-center gap-2.5"},cs=["src"],fs={class:"flex items-center gap-2.5"},ps=["src"],us={class:"flex flex-wrap items-center gap-4 sm:gap-6 font-mono text-[11px] tracking-wide"},ms={class:"flex flex-col items-center leading-none gap-1"},hs={class:"text-slate-200 font-bold text-sm"},bs={class:"flex flex-col items-center leading-none gap-1"},gs={class:"text-emerald-400 font-bold text-sm"},vs={class:"flex flex-col items-center leading-none gap-1"},ys={class:"text-rose-400 font-bold text-sm"},xs={class:"border-4 border-slate-700 bg-slate-950 flex flex-col overflow-hidden min-h-0 shadow-xl pixel-box"},_s={class:"p-4 border-b-4 border-slate-800 bg-slate-900 flex items-center justify-between"},ws={class:"text-[10px] font-mono text-slate-400 bg-slate-950 px-2 py-1 border border-slate-700 font-bold"},ks=["id","onClick"],Ms={key:0,class:"absolute left-0 top-0 bottom-0 w-1 bg-amber-500"},Cs={class:"flex items-center justify-between mb-2 opacity-80 group-hover:opacity-100 pl-2"},Is={class:"font-bold text-amber-100 font-mono tracking-tight uppercase"},Ss={key:0,class:"text-[10px] text-slate-500 font-bold"},Ts={class:"space-y-1.5 pl-2"},zs={key:0,class:"flex items-baseline gap-1.5 flex-wrap leading-relaxed"},Es={class:"text-emerald-400 font-bold"},Ps={class:"text-rose-400 font-bold"},Os={key:0,class:"text-[9px] text-slate-900 bg-amber-500 font-bold uppercase px-1"},As={key:1,class:"flex items-center gap-2 p-1 bg-rose-950/30 border border-rose-900/50 mt-1"},Rs={class:"flex flex-col"},Ns={class:"text-rose-300 font-bold"},Ls={key:2,class:"text-emerald-500/60 italic text-[11px] font-bold"},Ys={key:3,class:"flex items-center gap-1.5 text-[11px]"},Xs={class:"text-blue-400 font-bold"},Ds={key:0,class:"text-amber-500 font-bold"},Gs={key:4,class:"flex items-center gap-1.5 text-[10px] opacity-70"},Hs={class:"text-slate-400 font-bold"},Vs={class:"font-mono text-slate-500"},Bs={key:5,class:"flex items-center gap-1.5 text-[11px]"},js={class:"text-rose-300 font-bold"},$s={class:"text-[9px] bg-rose-900/50 text-rose-400 px-1 border border-rose-700"},Ws={key:6,class:"flex items-center gap-1.5 p-1 bg-amber-950/30 border border-amber-900/50"},Fs={class:"text-amber-400 font-bold"},Us={class:"text-[9px] text-amber-500"},Be=64,ke=32,je=24,Ks=mt({__name:"MatchViewer",setup(qs){const W={BG_DUNGEON:"https://vibemedia.space/bg_dungeon_v2_99283.png?prompt=dark%20dungeon%20floor%20tile%20texture%20seamless&style=pixel_game_asset&key=NOGON",CHAR_HERO:"https://vibemedia.space/hero_knight_v2_88441.png?prompt=fantasy%20knight%20character%20sprite%20standing%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",CHAR_ENEMY:"https://vibemedia.space/enemy_slime_v2_99223.png?prompt=cute%20slime%20monster%20sprite%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",ICON_SWORD:"https://vibemedia.space/icon_sword_px_11223.png?prompt=pixel%20art%20sword%20icon&style=pixel_game_asset&key=NOGON",ICON_SKULL:"https://vibemedia.space/icon_skull_px_99887.png?prompt=pixel%20art%20skull%20icon&style=pixel_game_asset&key=NOGON",ICON_TROPHY:"https://vibemedia.space/trophy_icon_4d5e6f_v1.png?prompt=golden%20trophy%20pixel%20art&style=pixel_game_asset&key=NOGON",TEX_FLOOR:"https://vibemedia.space/floor_cobble_7a8b9c_v1.png?prompt=cobblestone%20texture%20with%20worn%20stones%20and%20dirt%20between%20cracks&style=pixel_game_asset&key=NOGON",TEX_WALL:"https://vibemedia.space/wall_stone_1x2y3z_v1.png?prompt=stone%20brick%20texture%20with%20weathered%20gray%20surface%20and%20moss%20details&style=pixel_game_asset&key=NOGON"},oe=ht(),ae=St(),U=Tt(),$e=wt(),J=L($e.params.id),Y=L(null),F=L([]),fe=L(!1);let Q=null;const pe=L(null),K=L({}),ue={},Me=L(!1),We=()=>{let e=0;const t=Object.keys(W).length;Object.entries(W).forEach(([o,l])=>{const i=new Image;i.src=l,i.onload=()=>{e++,e===t&&(Me.value=!0)},ue[o]=i})},f=kt({x:0,y:0,zoom:1,shakeX:0,shakeY:0,isDragging:!1,lastX:0,lastY:0}),me=L([]),S=L(0),G=L(!1),ee=L(1);let H=0,le=null;const ne=L(null),O=(e,t)=>{if(!(!e||typeof e!="object"))return e[t]},V=e=>typeof e!="string"?"--":e.substring(0,6),Fe=se(()=>Y.value==="running"?"bg-amber-950 text-amber-500 border-amber-700":Y.value==="completed"?"bg-slate-950 text-slate-500 border-slate-700":"bg-emerald-950 text-emerald-500 border-emerald-700"),k=se(()=>F.value.map(e=>e.round)),Ce=se(()=>k.value.length?(k.value.indexOf(S.value)+1)/k.value.length*100:0),he=se(()=>{const e=K.value[S.value];if(!e)return{total:0,alive:0,fallen:0};const t=Object.values(e.entities);return{total:t.length,alive:t.filter(o=>o.alive).length,fallen:t.filter(o=>!o.alive).length}}),Ue=(e,t)=>{const o=(e-t)*Be*.5,l=(e+t)*ke*.5;return{x:o,y:l}},q=(e,t,o,l)=>{const i=Ue(e,t),p=o/2,n=l/4;return{x:p+i.x*f.zoom+f.x+f.shakeX,y:n+i.y*f.zoom+f.y+f.shakeY}},Ke=e=>{f.shakeX=(Math.random()-.5)*e,f.shakeY=(Math.random()-.5)*e},qe=e=>{f.isDragging=!0,f.lastX=e.clientX,f.lastY=e.clientY},Ze=e=>{if(!f.isDragging)return;const t=e.clientX-f.lastX,o=e.clientY-f.lastY;f.x+=t,f.y+=o,f.lastX=e.clientX,f.lastY=e.clientY},Ie=()=>{f.isDragging=!1},Je=e=>{const t=-Math.sign(e.deltaY)*.1;be(t)},be=e=>{f.zoom=Math.max(.2,Math.min(3,f.zoom+e))},ge={top:"#1e293b",side:"#0f172a",stroke:"#334155"},Qe=(e,t,o,l,i,p)=>{const n=q(t,o,l,i),r=f.zoom,c=Be*r,a=ke*r,T=(Math.sin(t*.5)+Math.cos(o*.5))*2*r,b=n.y-T,g=8*r;e.beginPath(),e.moveTo(n.x,b+a),e.lineTo(n.x+c/2,b+a/2),e.lineTo(n.x+c/2,b+a/2+g),e.lineTo(n.x,b+a+g),e.fillStyle=ge.side,e.fill(),e.beginPath(),e.moveTo(n.x,b+a),e.lineTo(n.x-c/2,b+a/2),e.lineTo(n.x-c/2,b+a/2+g),e.lineTo(n.x,b+a+g),e.fillStyle="#020617",e.fill(),e.beginPath(),e.moveTo(n.x,b),e.lineTo(n.x+c/2,b+a/2),e.lineTo(n.x,b+a),e.lineTo(n.x-c/2,b+a/2),e.closePath(),e.save(),e.clip(),Me.value&&ue.TEX_FLOOR?(e.drawImage(ue.TEX_FLOOR,n.x-c/2,b,c,a),e.fillStyle="rgba(30, 41, 59, 0.4)",e.fill()):(e.fillStyle=ge.top,e.fill()),(t+o*7)%5===0&&(e.fillStyle="rgba(255, 255, 255, 0.1)",e.fill()),e.restore(),e.strokeStyle=ge.stroke,e.lineWidth=1*r,e.stroke()},ve=(e,t,o)=>{const l=Math.cos(o),i=Math.sin(o);return{x:e*l-t*i,y:e*i+t*l}},ye=(e,t)=>{const o=parseInt(e.slice(1),16),l=t<0?0:255,i=t<0?t*-1:t,p=o>>16,n=o>>8&255,r=o&255;return"#"+(16777216+(Math.round((l-p)*i)+p)*65536+(Math.round((l-n)*i)+n)*256+(Math.round((l-r)*i)+r)).toString(16).slice(1)},et=(e,t,o,l,i,p,n,r,c,a,T,b)=>{const g=i/2,m=p/2,E=[{x:g,y:m},{x:-g,y:m},{x:-g,y:-m},{x:g,y:-m}],P=E.map(y=>{const z=ve(y.x,y.y,r);return{x:t+z.x,y:o+z.y,z:l+n}}),d=E.map(y=>{const z=ve(y.x,y.y,r);return{x:t+z.x,y:o+z.y,z:l}}),u=y=>{const z=q(y.x,y.y,T,b);return{x:z.x,y:z.y-y.z*ke*a}},h=P.map(u),x=d.map(u);e.fillStyle=ye(c,.1),e.beginPath(),e.moveTo(h[0].x,h[0].y);for(let y=1;y<4;y++)e.lineTo(h[y].x,h[y].y);e.closePath(),e.fill(),e.strokeStyle=ye(c,-.2),e.lineWidth=1,e.stroke();let v=0,M=h[0].y;for(let y=1;y<4;y++)h[y].y>M&&(M=h[y].y,v=y);const R=(y,z,X)=>{e.fillStyle=ye(c,X),e.beginPath(),e.moveTo(h[y].x,h[y].y),e.lineTo(h[z].x,h[z].y),e.lineTo(x[z].x,x[z].y),e.lineTo(x[y].x,x[y].y),e.closePath(),e.fill(),e.stroke()};R(v,(v+1)%4,-.3),R(v,(v+3)%4,-.1)},tt=(e,t,o,l,i,p,n,r,c,a,T,b,g)=>{const m=i?{head:"#fbbf24",body:"#3b82f6",leg:"#1e3a8a",arm:"#93c5fd"}:{head:"#4ade80",body:"#166534",leg:"#14532d",arm:"#86efac"};g&&(m.head="#ffffff",m.body="#ffffff",m.leg="#ffffff",m.arm="#ffffff");const P=p?Math.sin(a*.01):0,d=P*.5;let u=-P*.5,h=P*.5;if(n){const I=Math.sin(a*.03);h=-Math.PI/2+I*.5}const x=0+l*.01,v=[],M=.25,R=.25,y=.12,z=.3,X=.08,B=.08,N=.3,j=x+N;v.push({cx:0,cy:0,cz:j,w:R,d:y,h:z,offsetVec:{x:0,y:0,z:0},color:m.body}),v.push({cx:0,cy:0,cz:j+z,w:M,d:M,h:M,offsetVec:{x:0,y:0,z:Math.sin(a*.002)*.02},color:m.head});const Z=.06;v.push({cx:0,cy:Z,cz:x,w:X,d:B,h:N,offsetVec:{x:Math.sin(d)*.1,y:0,z:0},color:m.leg}),v.push({cx:0,cy:-Z,cz:x,w:X,d:B,h:N,offsetVec:{x:Math.sin(-d)*.1,y:0,z:0},color:m.leg});const $=j+z-.05,A=.16;if(v.push({cx:0,cy:A,cz:$-N,w:X,d:B,h:N,offsetVec:{x:Math.sin(u)*.1,y:0,z:Math.cos(u)*.1-.1},color:m.arm}),v.push({cx:0,cy:-A,cz:$-N,w:X,d:B,h:N,offsetVec:{x:Math.sin(h)*.2,y:0,z:Math.cos(h)*.1-.1},color:m.arm}),n){const te=Math.sin(h)*.2,xe=$-N+Math.cos(h)*.1-.1;v.push({cx:.1,cy:-A-.05,cz:xe,w:.4,d:.05,h:.05,offsetVec:{x:te+.2,y:0,z:0},color:"#cbd5e1"})}const ie=v.map(I=>{let te=I.cx+I.offsetVec.x,xe=I.cy+I.offsetVec.y,Ae=I.cz+I.offsetVec.z;const Re=ve(te,xe,r),Ne=t+Re.x,Le=o+Re.y,ut=Ne+Le+Ae*.1;return{...I,wx:Ne,wy:Le,wz:Ae,depth:ut}});ie.sort((I,te)=>I.depth-te.depth),ie.forEach(I=>{et(e,I.wx,I.wy,I.wz,I.w,I.d,I.h,r,I.color,c,T,b)})},st=(e,t,o,l,i,p,n,r)=>{const c=q(o,l,i,p),a=f.zoom;if(!t.alive){e.fillStyle="#334155";const A=10*a;e.beginPath(),e.rect(c.x-A/2,c.y,A,A),e.fill();return}const T=Math.sin(n/300+t.floatOffset)*2*a,b=r?.hit?(Math.random()-.5)*5*a:0,g=c.y-12*a+T,m=c.x+b;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(c.x,c.y+14*a,10*a,5*a,0,0,Math.PI*2),e.fill();const E=t.isMoving||!1;let P=0;(t.vx!=null||t.vy!=null)&&(P=Math.atan2(t.vy??0,t.vx??0)),tt(e,o,l,T,t.isPlayer,E,r?.attacking||!1,P,a,n,i,p,r?.hit);const d=Math.max(0,t.hp/t.maxHp),u=24*a,h=4*a,x=m-u/2,v=g-50*a;e.fillStyle="#000",e.fillRect(x-1,v-1,u+2,h+2),e.fillStyle=d>.5?"#10b981":d>.25?"#f59e0b":"#ef4444",e.fillRect(x,v,u*d,h);const M=t.momentum||0,y=M/100,z=24*a,X=3*a,B=m-z/2,N=v-X-3*a;e.fillStyle="#1e293b",e.fillRect(B,N,z,X);let j="#3b82f6";if(M>30&&(j="#8b5cf6"),M>60&&(j="#f59e0b"),M>80&&(j="#ef4444"),e.fillStyle=j,e.fillRect(B,N,z*y,X),e.strokeStyle="#475569",e.lineWidth=.5,e.strokeRect(B,N,z,X),t.flurryActive||r?.flurryActive){const A=Math.sin(n/100)*.3+.7;e.save(),e.globalAlpha=A*.5,e.strokeStyle="#f59e0b",e.lineWidth=2*a,e.beginPath(),e.arc(m,g-20*a,15*a,0,Math.PI*2),e.stroke(),e.restore()}const Z=t.sunderStacks||0;if(Z>0){const A=4*a,ie=m-Z*A/2;for(let I=0;I<Z;I++)e.fillStyle="#ef4444",e.fillRect(ie+I*(A+1),N-A-2,A,A)}const $=t.consecutiveHits||0;$>1&&(e.save(),e.font=`bold ${Math.round(10*a)}px 'Courier New', monospace`,e.textAlign="center",e.fillStyle=$>=5?"#ef4444":$>=3?"#f59e0b":"#fbbf24",e.fillText(`${$}x`,m+u/2+10*a,v+h),e.restore())},ot=(e,t,o,l)=>{for(let i=me.value.length-1;i>=0;i--){const p=me.value[i];if(p.life-=l,p.life<=0){me.value.splice(i,1);continue}p.x+=p.vx*l*.06,p.y+=p.vy*l*.06,p.z+=p.vz*l*.06,p.vz-=.02,p.z<0&&(p.z=0,p.vx*=.5,p.vy*=.5);const n=q(p.x,p.y,t,o),r=f.zoom,c=n.y-p.z*10*r;e.fillStyle=p.color;const a=Math.max(2,p.size*r);e.fillRect(n.x-a/2,c-a/2,a,a)}},at=(e,t,o,l,i)=>{for(const n of t.events.attacks){const r=t.entities[n.attackerId],c=t.entities[n.targetId];if(!r||!c)continue;const a=q(r.x,r.y,o,l),T=q(c.x,c.y,o,l);a.y-=30*f.zoom,T.y-=30*f.zoom;const b=n.isCritical;if(i<.5){const g=i/.5,m=a.x+(T.x-a.x)*g,E=a.y+(T.y-a.y)*g,P=Math.sin(g*Math.PI)*40*f.zoom,d=8*f.zoom,u=m,h=E-P,x=e.createRadialGradient(u-d/3,h-d/3,d/6,u,h,d*1.2);b?(x.addColorStop(0,"#ffffff"),x.addColorStop(.2,"#fef3c7"),x.addColorStop(.5,"#fbbf24"),x.addColorStop(.8,"#d97706"),x.addColorStop(1,"rgba(180, 83, 9, 0)")):(x.addColorStop(0,"#ffffff"),x.addColorStop(.2,"#dbeafe"),x.addColorStop(.5,"#60a5fa"),x.addColorStop(.8,"#2563eb"),x.addColorStop(1,"rgba(30, 64, 175, 0)")),e.save(),e.shadowColor=b?"#fbbf24":"#60a5fa",e.shadowBlur=15*f.zoom,e.fillStyle=x,e.beginPath(),e.arc(u,h,d,0,Math.PI*2),e.fill(),e.restore();const v=e.createRadialGradient(u,h,0,u,h,d*.4);if(v.addColorStop(0,"rgba(255, 255, 255, 0.9)"),v.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=v,e.beginPath(),e.arc(u,h,d*.4,0,Math.PI*2),e.fill(),g>.1){const M=e.createLinearGradient(a.x,a.y,u,h);b?(M.addColorStop(0,"rgba(251, 191, 36, 0)"),M.addColorStop(.5,"rgba(251, 191, 36, 0.3)"),M.addColorStop(1,"rgba(251, 191, 36, 0.8)")):(M.addColorStop(0,"rgba(96, 165, 250, 0)"),M.addColorStop(.5,"rgba(96, 165, 250, 0.3)"),M.addColorStop(1,"rgba(96, 165, 250, 0.8)")),e.strokeStyle=M,e.lineWidth=3*f.zoom,e.lineCap="round",e.beginPath(),e.moveTo(a.x,a.y),e.quadraticCurveTo(a.x+(T.x-a.x)*.5,a.y+(T.y-a.y)*.5-40*f.zoom,u,h),e.stroke()}}if(i>=.5&&i<.5+.3){const g=(i-.5)/.3,m=T.x,E=T.y-20*f.zoom,P=(b?30:20)*f.zoom*(.3+g*.7),d=1-g;e.save(),e.globalAlpha=d;const u=e.createRadialGradient(m,E,P*.5,m,E,P);if(b?(u.addColorStop(0,"rgba(251, 191, 36, 0)"),u.addColorStop(.6,"rgba(251, 191, 36, 0.8)"),u.addColorStop(.8,"rgba(245, 158, 11, 0.6)"),u.addColorStop(1,"rgba(217, 119, 6, 0)")):(u.addColorStop(0,"rgba(96, 165, 250, 0)"),u.addColorStop(.6,"rgba(96, 165, 250, 0.8)"),u.addColorStop(.8,"rgba(59, 130, 246, 0.6)"),u.addColorStop(1,"rgba(37, 99, 235, 0)")),e.fillStyle=u,e.beginPath(),e.arc(m,E,P,0,Math.PI*2),e.fill(),g<.5){const v=1-g/.5,M=(b?15:10)*f.zoom*(1-g*.5);e.globalAlpha=v,e.shadowColor=b?"#fbbf24":"#60a5fa",e.shadowBlur=20*f.zoom;const R=e.createRadialGradient(m,E,0,m,E,M);R.addColorStop(0,"#ffffff"),R.addColorStop(.5,b?"#fef3c7":"#dbeafe"),R.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=R,e.beginPath(),e.arc(m,E,M,0,Math.PI*2),e.fill()}const h=b?8:5,x=(b?25:15)*f.zoom*(.5+g*.5);e.globalAlpha=d*.8,e.strokeStyle=b?"#fef3c7":"#dbeafe",e.lineWidth=2*f.zoom,e.lineCap="round";for(let v=0;v<h;v++){const M=Math.PI*2/h*v+g*.5,R=P*.3,y=R+x*(1-g*.5);e.beginPath(),e.moveTo(m+Math.cos(M)*R,E+Math.sin(M)*R),e.lineTo(m+Math.cos(M)*y,E+Math.sin(M)*y),e.stroke()}e.restore()}if(i>=.5){const g=(i-.5)/.5,m=Math.min(1,g*3),P=(1-Math.pow(1-m,3))*60*f.zoom,d=Math.max(0,1-g*1.5);e.save(),e.globalAlpha=d;const u=Math.round((n.isCritical?24:14)*f.zoom);e.font=`bold ${u}px 'Courier New', monospace`,e.textAlign="center";const h=`${n.damage}`,x=T.x,v=T.y-30*f.zoom-P;e.lineWidth=3,e.strokeStyle="black",e.strokeText(h,x,v),e.fillStyle=n.isCritical?"#fbbf24":"#fff",e.fillText(h,x,v),n.isCritical&&(e.font=`bold ${Math.round(10*f.zoom)}px 'Courier New', monospace`,e.fillStyle="#f59e0b",e.fillText("CRIT!",x,v-20*f.zoom)),e.restore()}}},lt=e=>{if(!pe.value)return;const t=pe.value,o=t.getContext("2d");if(!o)return;const l=t.getBoundingClientRect();(t.width!==l.width||t.height!==l.height)&&(t.width=l.width,t.height=l.height),f.shakeX*=.9,f.shakeY*=.9,Math.abs(f.shakeX)<.5&&(f.shakeX=0),Math.abs(f.shakeY)<.5&&(f.shakeY=0);let i=S.value,p=0;if(G.value&&H>0){const d=1e3/ee.value;p=Math.min(1,(e-H)/d)}const n=K.value[i];if(!n)return;const r=k.value.indexOf(i)+1,c=k.value[r],a=c?K.value[c]:void 0;o.clearRect(0,0,t.width,t.height);for(let d=0;d<=je;d++)for(let u=0;u<=je;u++)Qe(o,d,u,t.width,t.height);const T=nt(n,a,p),b=new Set,g=new Set,m=new Set,E={};n.events?.attacks&&(p>=.5&&p<.5+.2&&n.events.attacks.forEach(u=>b.add(u.targetId)),p<.4&&n.events.attacks.forEach(u=>g.add(u.attackerId))),n.events?.momentum&&n.events.momentum.forEach(d=>{E[d.fighterId]=d}),n.events?.flurry&&n.events.flurry.forEach(d=>m.add(d.fighterId));const P=Object.values(T).map(d=>({type:"entity",yDepth:d.x+d.y,entity:d,x:d.x,y:d.y,hit:b.has(d.id),attacking:g.has(d.id),momentumEvent:E[d.id],flurryActive:m.has(d.id)}));P.sort((d,u)=>d.yDepth-u.yDepth);for(const d of P)d.type==="entity"&&st(o,d.entity,d.x,d.y,t.width,t.height,e,{hit:d.hit,attacking:d.attacking,momentumEvent:d.momentumEvent,flurryActive:d.flurryActive});ot(o,t.width,t.height,16),at(o,n,t.width,t.height,p)},nt=(e,t,o)=>{if(!t||o<=0)return e.entities;const l={};return new Set([...Object.keys(e.entities),...Object.keys(t.entities)]).forEach(p=>{const n=e.entities[p],r=t.entities[p];if(n&&r){const c=r.x-n.x,a=r.y-n.y,T=o<1&&(Math.abs(c)>.001||Math.abs(a)>.001);l[p]={...n,x:n.x+c*o,y:n.y+a*o,hp:n.hp+(r.hp-n.hp)*o,alive:o<.8?n.alive:r.alive,floatOffset:n.floatOffset,vx:c,vy:a,isMoving:T}}else r?l[p]={...r,isMoving:!1,vx:0,vy:0}:n&&(l[p]={...n,isMoving:!1,vx:0,vy:0})}),l},Se=e=>{if(lt(e),G.value){H||(H=e);const t=1e3/ee.value,o=(e-H)/t;if(o>.1&&o<.15&&K.value[S.value]?.events.attacks.some(i=>i.isCritical)&&Ke(2*f.zoom),o>=1){const i=k.value.indexOf(S.value)+1;i>=k.value.length?(G.value=!1,H=0):(S.value=k.value[i],H=e,re(S.value))}}le=requestAnimationFrame(Se)},Te=e=>{const t=k.value.indexOf(S.value);if(t===-1)return;const o=t+e;o<0||o>=k.value.length||(S.value=k.value[o],re(S.value))},re=e=>{Mt(()=>{const t=document.getElementById("log-round-"+e);if(t&&ne.value){const o=t.offsetTop-ne.value.offsetTop;ne.value.scrollTo({top:o-100,behavior:"smooth"})}})},rt=e=>{if(!k.value.length)return;const t=e.currentTarget.getBoundingClientRect(),o=e.clientX-t.left,l=Math.max(0,Math.min(1,o/t.width)),i=Math.floor(l*(k.value.length-1));S.value=k.value[i],re(S.value)},it=e=>{S.value=e,G.value=!1},dt=()=>{k.value.length<=1||(G.value?G.value=!1:(S.value===k.value[k.value.length-1]&&(S.value=k.value[0]),G.value=!0,H=0))},ze=se(()=>{if(!ae.fighters.length)return!1;const e=new Set(ae.fighters.map(o=>o.id)),t=K.value[k.value[k.value.length-1]];return t?Object.values(t.entities).some(o=>e.has(o.id)&&o.alive):!1}),ct=async()=>{try{await U.claimAll(),window.location.href="/matches"}catch(e){console.error("Failed to claim rewards:",e)}},Ee=async()=>{if(!(!oe.token||!J.value)){fe.value=!0;try{const t=await He(`${Ve.match}/${J.value}/roundticks`,{token:oe.token})||[],o=F.value.length;if(F.value=t,ft(),Y.value==="running"&&t.length>o&&t.length>0){const l=t[t.length-1]?.round;l!=null&&(S.value=l,re(l))}}catch(e){console.error(e)}finally{fe.value=!1}}},Pe=async()=>{if(!(!oe.token||!J.value))try{const e=await He(`${Ve.match}/${J.value}`,{token:oe.token});return Y.value=e?.status??null,e?.status}catch{return Y.value=null,null}},ft=()=>{const e=new Set(ae.fighters.map(l=>l.id)),t=new Map,o={};for(const l of F.value){const i={attacks:[],deaths:[],momentum:[],sunder:[],flurry:[]};for(const n of l.ticks||[]){const r=n.payload;if(r){if(n.type==="spawn"){const c=r.fighterId;t.set(c,{id:c,x:r.x??0,y:r.y??0,hp:r.hp??100,maxHp:r.hp??100,alive:!0,isPlayer:e.has(c),floatOffset:Math.random()*Math.PI*2,momentum:0,consecutiveHits:0,sunderStacks:0,flurryActive:!1})}else if(n.type==="move"){const c=r.fighterId,a=t.get(c);a&&(a.x=r.toX??a.x,a.y=r.toY??a.y)}else if(n.type==="attack"){i.attacks.push({attackerId:r.attackerId,targetId:r.targetId,isCritical:r.isCritical,isParried:r.isParried,damage:r.damage});const c=t.get(r.targetId);c&&(c.hp=Math.max(0,c.hp-(r.damage||0)))}else if(n.type==="died"){const c=r.fighterId,a=t.get(c);a&&(a.alive=!1,a.hp=0),i.deaths.push(c)}else if(n.type==="momentum"||n.type==="momentum_decay"){const c={fighterId:r.fighterId,momentum:r.momentum,consecutiveHits:r.consecutiveHits,targetId:r.targetId};i.momentum.push(c);const a=t.get(r.fighterId);a&&(a.momentum=r.momentum,a.consecutiveHits=r.consecutiveHits)}else if(n.type==="sunder"){const c={targetId:r.targetId,stacks:r.stacks,armorReduced:r.armorReduced};i.sunder.push(c);const a=t.get(r.targetId);a&&(a.sunderStacks=r.stacks)}else if(n.type==="flurry"){const c={fighterId:r.fighterId,attackSpeedBonus:r.attackSpeedBonus};i.flurry.push(c);const a=t.get(r.fighterId);a&&(a.flurryActive=!0)}}}const p={};t.forEach((n,r)=>{p[r]={...n}}),o[l.round]={round:l.round,entities:p,events:i}}K.value=o};function pt(){Q||(Q=window.setInterval(async()=>{const e=await Pe();await Ee(),e==="completed"&&Oe()},2500))}function Oe(){Q&&(clearInterval(Q),Q=null)}return bt(async()=>{await ae.fetchFighters(),await U.fetchRewards(),We(),await Pe(),await Ee(),k.value.length&&(Y.value==="completed"?S.value=k.value[0]:S.value=k.value[k.value.length-1]),le=requestAnimationFrame(Se),Y.value==="running"&&pt()}),gt(()=>{le&&cancelAnimationFrame(le),Oe()}),(e,t)=>(_(),w("div",{class:"pixel-theme h-dvh max-h-dvh overflow-hidden flex flex-col gap-3 sm:gap-4 font-mono text-slate-200",style:we({backgroundImage:`url('${W.BG_DUNGEON}')`})},[t[37]||(t[37]=s("div",{class:"fixed inset-0 bg-slate-950/80 pointer-events-none z-0"},null,-1)),s("header",zt,[s("div",Et,[Ye(It,{variant:"ghost",size:"sm",onClick:t[0]||(t[0]=o=>e.$router.push("/matches")),"class-name":"rpg-btn-small"},{default:Xe(()=>[...t[7]||(t[7]=[_e(" ← BACK ",-1)])]),_:1}),s("div",null,[s("h1",Pt,[_e(" BATTLE LOG #"+C(J.value?.substring(0,8))+" ",1),Y.value?(_(),w("span",{key:0,class:de(["px-2 py-0.5 text-xs font-bold uppercase tracking-wider border-2",Fe.value])},C(Y.value),3)):D("",!0)])])]),Y.value==="running"?(_(),w("div",Ot,[...t[8]||(t[8]=[s("span",{class:"relative flex h-2 w-2"},[s("span",{class:"animate-ping absolute inline-flex h-full w-full bg-amber-400 opacity-75"}),s("span",{class:"relative inline-flex h-2 w-2 bg-amber-500"})],-1),s("span",{class:"text-xs font-bold text-amber-400 uppercase tracking-widest blink"},"LIVE FEED",-1)])])):D("",!0)]),s("div",At,[s("div",Rt,[s("div",Nt,[fe.value?(_(),w("div",Lt,[...t[9]||(t[9]=[s("div",{class:"flex flex-col items-center gap-3"},[s("div",{class:"h-8 w-8 animate-spin border-4 border-amber-500 border-t-transparent"}),s("p",{class:"text-amber-200 text-sm font-bold uppercase tracking-wider"},"Loading battle data...")],-1)])])):F.value.length?D("",!0):(_(),w("div",Yt,[...t[10]||(t[10]=[s("p",{class:"text-slate-500 font-bold uppercase tracking-wider"},"Waiting for battle data...",-1)])])),s("canvas",{ref_key:"canvasRef",ref:pe,class:"w-full h-full object-cover cursor-move pixelated",onMousedown:qe,onMousemove:Ze,onMouseup:Ie,onMouseleave:Ie,onWheel:vt(Je,["prevent"])},null,544),t[16]||(t[16]=s("div",{class:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"},null,-1)),t[17]||(t[17]=s("div",{class:"absolute inset-0 pointer-events-none opacity-10 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-size-[100%_4px]"},null,-1)),Ye(yt,{name:"fade"},{default:Xe(()=>[Y.value==="completed"&&k.value.length&&S.value===k.value[k.value.length-1]?(_(),w("div",Xt,[s("div",Dt,[ze.value?(_(),w("img",{key:0,src:W.ICON_TROPHY,class:"w-16 h-16 mx-auto mb-2 pixelated animate-bounce-slow"},null,8,Gt)):(_(),w("img",{key:1,src:W.ICON_SKULL,class:"w-16 h-16 mx-auto mb-2 pixelated opacity-50"},null,8,Ht)),ze.value?(_(),w("h2",Vt,"VICTORY")):(_(),w("h2",Bt,"DEFEAT")),s("div",jt,[t[13]||(t[13]=s("h3",{class:"text-xs font-bold text-slate-500 uppercase mb-3 text-shadow-retro"},"Rewards available to claim",-1)),ce(U).rewardCount>0?(_(),w("div",$t,[s("div",Wt,[t[11]||(t[11]=s("span",{class:"text-slate-400"},"Match Bonus:",-1)),s("span",Ft,"+ "+C(ce(U).rewardCount*20)+" Particles",1)]),s("button",{class:"rpg-btn-small mt-2 w-full !bg-amber-600 !text-slate-900 border-amber-800 hover:!bg-amber-500 font-bold",onClick:ct,disabled:ce(U).isLoading},C(ce(U).isLoading?"CLAIMING...":"CLAIM & EXIT"),9,Ut)])):(_(),w("div",Kt,[t[12]||(t[12]=s("p",{class:"text-slate-500 text-xs italic"},"All rewards claimed or none earned.",-1)),s("button",{class:"rpg-btn-small mt-3 w-full font-bold",onClick:t[1]||(t[1]=o=>e.$router.push("/matches"))},"EXIT TO MAP")]))])])])):D("",!0)]),_:1}),s("div",qt,[s("div",{class:"relative h-4 bg-slate-950 border-2 border-slate-700 cursor-pointer group/bar",onClick:rt},[s("div",{class:"absolute inset-y-0 left-0 bg-amber-600 transition-all duration-100",style:we({width:Ce.value+"%"})},null,4),s("div",{class:"absolute inset-y-0 w-2 bg-white opacity-0 group-hover/bar:opacity-100 transition-opacity",style:we({left:Ce.value+"%"})},null,4)]),s("div",Zt,[s("div",Jt,[s("button",{onClick:dt,class:"rpg-btn-small bg-amber-600 border-amber-800 text-slate-900 hover:bg-amber-500 font-black h-10 w-10 flex items-center justify-center"},[G.value?(_(),w("span",Qt,"||")):(_(),w("span",es,">"))]),s("div",ts,[s("button",{onClick:t[2]||(t[2]=o=>Te(-1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},"<<"),s("span",ss,"RND "+C(S.value),1),s("button",{onClick:t[3]||(t[3]=o=>Te(1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},">>")])]),s("div",os,[s("div",as,[t[14]||(t[14]=s("span",{class:"uppercase font-bold"},"SPD",-1)),xt(s("input",{type:"range",min:"0.5",max:"4",step:"0.5","onUpdate:modelValue":t[4]||(t[4]=o=>ee.value=o),class:"w-20 accent-amber-500 h-2 bg-slate-800 appearance-none cursor-pointer"},null,512),[[_t,ee.value,void 0,{number:!0}]]),s("span",ls,C(ee.value)+"x",1)]),s("div",ns,[t[15]||(t[15]=s("span",{class:"uppercase font-bold"},"ZM",-1)),s("button",{onClick:t[5]||(t[5]=o=>be(-.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"-"),s("span",rs,C(Math.round(f.zoom*100))+"%",1),s("button",{onClick:t[6]||(t[6]=o=>be(.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"+")])])])])]),s("div",is,[s("div",ds,[s("img",{src:W.ICON_SWORD,class:"w-4 h-4 pixelated"},null,8,cs),t[18]||(t[18]=s("span",{class:"font-bold text-emerald-200 uppercase"},"Heroes",-1))]),s("div",fs,[s("img",{src:W.ICON_SKULL,class:"w-4 h-4 pixelated"},null,8,ps),t[19]||(t[19]=s("span",{class:"font-bold text-rose-200 uppercase"},"Enemies",-1))]),t[25]||(t[25]=s("div",{class:"flex-1 hidden sm:block"},null,-1)),s("div",us,[s("div",ms,[t[20]||(t[20]=s("span",{class:"text-slate-500 font-bold uppercase"},"TOTAL",-1)),s("span",hs,C(he.value.total),1)]),t[23]||(t[23]=s("div",{class:"w-px h-6 bg-slate-700"},null,-1)),s("div",bs,[t[21]||(t[21]=s("span",{class:"text-emerald-500/70 font-bold uppercase"},"ALIVE",-1)),s("span",gs,C(he.value.alive),1)]),t[24]||(t[24]=s("div",{class:"w-px h-6 bg-slate-700"},null,-1)),s("div",vs,[t[22]||(t[22]=s("span",{class:"text-rose-500/70 font-bold uppercase"},"FALLEN",-1)),s("span",ys,C(he.value.fallen),1)])])])]),s("div",xs,[s("div",_s,[t[26]||(t[26]=s("h3",{class:"font-bold text-amber-500 text-sm uppercase tracking-wider flex items-center gap-2"},[s("span",{class:"w-2 h-2 bg-amber-500 animate-pulse"}),_e(" Combat Log ")],-1)),s("span",ws,C(F.value.length)+" TICKS",1)]),s("div",{class:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar scroll-smooth bg-[#020617]",ref_key:"logsContainer",ref:ne},[(_(!0),w(De,null,Ge(F.value,o=>(_(),w("div",{key:o.round,id:"log-round-"+o.round,onClick:l=>it(o.round),class:de(["border-2 p-3 text-xs transition-all cursor-pointer group relative overflow-hidden",o.round===S.value?"border-amber-600 bg-amber-900/20":"border-slate-800 hover:border-slate-600 hover:bg-slate-900"])},[o.round===S.value?(_(),w("div",Ms)):D("",!0),s("div",Cs,[s("span",Is,"ROUND "+C(o.round.toString().padStart(2,"0")),1),o.ticks?.length?(_(),w("span",Ss,C(o.ticks.length)+" EVENTS",1)):D("",!0)]),s("div",Ts,[(_(!0),w(De,null,Ge(o.ticks,(l,i)=>(_(),w("div",{key:i,class:"pl-3 border-l-2 border-slate-800 py-0.5 relative"},[t[36]||(t[36]=s("div",{class:"absolute -left-[5px] top-2 w-[8px] h-[8px] bg-slate-800 border border-slate-600 rotate-45"},null,-1)),l.type==="attack"?(_(),w("div",zs,[s("span",Es,C(V(O(l.payload,"attackerId"))),1),t[27]||(t[27]=s("span",{class:"text-slate-600 text-[10px] uppercase font-bold tracking-wider"},"HIT",-1)),s("span",Ps,C(V(O(l.payload,"targetId"))),1),s("span",{class:de(["font-mono font-bold ml-1",O(l.payload,"isCritical")?"text-amber-400 text-sm":"text-slate-300"])}," -"+C(O(l.payload,"damage")),3),O(l.payload,"isCritical")?(_(),w("span",Os,"CRIT")):D("",!0)])):l.type==="died"?(_(),w("div",As,[t[29]||(t[29]=s("span",{class:"text-rose-500 text-lg"},"☠",-1)),s("div",Rs,[t[28]||(t[28]=s("span",{class:"text-rose-500 font-bold uppercase text-[10px] tracking-wide"},"SLAIN",-1)),s("span",Ns,C(V(O(l.payload,"fighterId"))),1)])])):l.type==="spawn"?(_(),w("div",Ls," ✨ "+C(V(O(l.payload,"fighterId")))+" APPEARED ",1)):l.type==="momentum"?(_(),w("div",Ys,[s("span",Xs,C(V(O(l.payload,"fighterId"))),1),t[30]||(t[30]=s("span",{class:"text-slate-500 uppercase"},"MOMENTUM",-1)),s("span",{class:de(["font-mono font-bold",O(l.payload,"momentum")>50?"text-amber-400":"text-blue-400"])},C(O(l.payload,"momentum"))+"% ",3),O(l.payload,"consecutiveHits")>1?(_(),w("span",Ds," ["+C(O(l.payload,"consecutiveHits"))+"x] ",1)):D("",!0)])):l.type==="momentum_decay"?(_(),w("div",Gs,[s("span",Hs,C(V(O(l.payload,"fighterId"))),1),t[31]||(t[31]=s("span",{class:"text-slate-600 uppercase"},"DECAY",-1)),s("span",Vs,C(O(l.payload,"momentum"))+"%",1)])):l.type==="sunder"?(_(),w("div",Bs,[t[32]||(t[32]=s("span",{class:"text-rose-400 font-bold"},"SUNDER",-1)),t[33]||(t[33]=s("span",{class:"text-slate-500"},"→",-1)),s("span",js,C(V(O(l.payload,"targetId"))),1),s("span",$s," -"+C(O(l.payload,"armorReduced"))+" ARMOR ",1)])):l.type==="flurry"?(_(),w("div",Ws,[t[34]||(t[34]=s("span",{class:"text-amber-500"},"⚡",-1)),s("span",Fs,C(V(O(l.payload,"fighterId"))),1),t[35]||(t[35]=s("span",{class:"text-amber-300 uppercase text-[10px] tracking-wider font-bold"},"FLURRY!",-1)),s("span",Us,"+"+C(O(l.payload,"attackSpeedBonus"))+"% SPD",1)])):D("",!0)]))),128))])],10,ks))),128))],512)])])],4))}}),to=Ct(Ks,[["__scopeId","data-v-f8c00004"]]);export{to as default};
