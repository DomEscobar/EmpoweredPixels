import{C as n,D as o,E as a,u as r}from"./index-DzKNk8gt.js";async function u(s){return n(o.league,{token:s})}async function c(s,t){return n(`${o.league}/${t}`,{token:s})}async function l(s,t){return n(`${o.league}/${t}/subscriptions/user`,{token:s})}async function h(s,t){return n(`${o.league}/${t}/subscriptions`,{token:s})}async function b(s,t,e){return n(`${o.league}/subscribe`,{method:"POST",token:s,body:{leagueId:t,fighterId:e}})}async function g(s,t,e){return n(`${o.league}/unsubscribe`,{method:"POST",token:s,body:{leagueId:t,fighterId:e}})}async function f(s,t,e=1,i=20){return n(`${o.league}/${t}/matches`,{method:"POST",token:s,body:{page:e,pageSize:i}})}async function p(s,t,e=50){return n(`${o.league}/${t}/highscores`,{method:"POST",token:s,body:{lastMatches:e}})}const S=a("leagues",{state:()=>({leagues:[],subscriptions:{},allSubscriptions:{},leagueMatches:{},leagueHighscores:{},selectedLeague:null,isLoading:!1,isLoadingDetail:!1,isSubscribing:!1,error:null}),actions:{async fetchLeagues(){const s=r();if(s.token){this.isLoading=!0,this.error=null;try{this.leagues=await u(s.token),await Promise.all(this.leagues.map(t=>this.fetchSubscriptions(t.id)))}catch{this.error="Failed to load leagues"}finally{this.isLoading=!1}}},async fetchSubscriptions(s){const t=r();if(t.token)try{const e=await l(t.token,s);this.subscriptions[s]=e}catch(e){console.error(`Failed to load subscriptions for league ${s}`,e)}},async fetchLeagueDetail(s){const t=r();if(t.token){this.isLoadingDetail=!0,this.error=null;try{this.selectedLeague=await c(t.token,s),this.allSubscriptions[s]=this.selectedLeague.subscriptions}catch{this.error="Failed to load league details",this.selectedLeague=null}finally{this.isLoadingDetail=!1}}},async fetchAllSubscriptions(s){const t=r();if(t.token)try{this.allSubscriptions[s]=await h(t.token,s)}catch(e){console.error(`Failed to load all subscriptions for league ${s}`,e)}},async subscribe(s,t){const e=r();if(e.token){this.isSubscribing=!0,this.error=null;try{await b(e.token,s,t),this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push({leagueId:s,fighterId:t}),await this.fetchAllSubscriptions(s)}catch(i){throw this.error="Failed to subscribe",i}finally{this.isSubscribing=!1}}},async unsubscribe(s,t){const e=r();if(e.token){this.isSubscribing=!0,this.error=null;try{await g(e.token,s,t),this.subscriptions[s]&&(this.subscriptions[s]=this.subscriptions[s].filter(i=>i.fighterId!==t)),await this.fetchAllSubscriptions(s)}catch(i){throw this.error="Failed to unsubscribe",i}finally{this.isSubscribing=!1}}},async fetchLeagueMatches(s,t=1){const e=r();if(e.token)try{const i=await f(e.token,s,t,20);this.leagueMatches[s]=i.items}catch(i){console.error(`Failed to load matches for league ${s}`,i)}},async fetchLeagueHighscores(s){const t=r();if(t.token)try{this.leagueHighscores[s]=await p(t.token,s)}catch(e){console.error(`Failed to load highscores for league ${s}`,e)}},clearSelectedLeague(){this.selectedLeague=null}},getters:{activeLeagueCount:s=>{let t=0;for(const e in s.subscriptions)s.subscriptions[e].length>0&&t++;return t},isSubscribedToLeague:s=>t=>(s.subscriptions[t]?.length??0)>0,getSubscribedFighters:s=>t=>s.subscriptions[t]??[],getParticipantCount:s=>t=>s.allSubscriptions[t]?.length??0}});export{S as u};
