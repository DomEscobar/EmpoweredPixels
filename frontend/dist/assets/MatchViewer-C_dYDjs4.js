import{d as ht,u as bt,l as A,y as mt,z as gt,o as C,c as M,a as o,g as Xe,w as Ye,b as ve,t as P,n as xe,j as Y,k as vt,e as ae,T as xt,q as ye,i as yt,v as wt,F as De,s as Ge,I as _t,J as kt,x as q,K as Ct,C as Ve,D as je,_ as Mt}from"./index-DQdTdbkb.js";import{_ as St}from"./BaseButton.vue_vue_type_script_setup_true_lang-DRkUkdbP.js";import{u as It}from"./store-CErdpwe4.js";import{u as Tt}from"./store-Cu-YRoxu.js";const zt={class:"relative z-10 flex flex-col sm:flex-row sm:items-center justify-between shrink-0 p-3 sm:p-4 border-b-4 border-amber-900/50 bg-slate-900/80 gap-3 sm:gap-4"},Pt={class:"flex items-center gap-3 sm:gap-4 min-w-0"},Ot={class:"text-lg sm:text-2xl font-black tracking-tight text-amber-500 flex flex-wrap items-center gap-2 sm:gap-3 uppercase text-shadow-retro"},Et={key:0,class:"flex items-center gap-2 px-3 py-1 bg-black/60 border border-amber-500/50"},At={class:"relative z-10 flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 min-h-0 px-3 sm:px-4 pb-3 sm:pb-4 overflow-y-auto lg:overflow-hidden"},Rt={class:"lg:col-span-2 flex flex-col gap-3 sm:gap-4 min-h-0 min-w-0"},Lt={class:"relative flex-1 min-h-[45vh] sm:min-h-[55vh] border-4 border-slate-700 bg-[#020617] overflow-hidden shadow-2xl flex flex-col group pixel-box"},Nt={key:0,class:"absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm"},Xt={key:1,class:"absolute inset-0 z-10 flex items-center justify-center"},Yt={key:0,class:"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Dt={class:"max-w-md w-full text-center border-4 border-amber-500 bg-slate-900 p-6 shadow-2xl pixel-box animate-in zoom-in duration-300"},Gt=["src"],Vt=["src"],jt={key:2,class:"text-3xl font-black text-amber-500 tracking-widest uppercase text-shadow-retro"},$t={key:3,class:"text-3xl font-black text-rose-500 tracking-widest uppercase text-shadow-retro"},Ht={class:"mt-4 p-4 bg-slate-950/50 border-2 border-slate-800"},Wt={key:0,class:"flex flex-col gap-2"},Bt={class:"flex items-center justify-between text-sm"},Ft={class:"text-amber-400 font-bold"},Ut=["disabled"],Kt={key:1,class:"py-4"},qt={class:"absolute bottom-0 inset-x-0 bg-slate-900/90 border-t-4 border-slate-700 p-3 sm:p-4 flex flex-col gap-3 transition-opacity duration-300 opacity-0 group-hover:opacity-100"},Zt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-1 gap-3"},Jt={class:"flex items-center gap-3 sm:gap-4"},Qt={key:0},es={key:1,class:"ml-1"},ts={class:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},ss={class:"text-xs font-mono text-amber-400 w-20 text-center font-bold"},os={class:"flex flex-wrap items-center gap-3 sm:gap-4"},as={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},ls={class:"w-8 text-right text-amber-200 font-mono font-bold"},ns={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},rs={class:"w-10 text-center font-mono font-bold"},is={class:"flex flex-wrap items-center gap-3 sm:gap-6 px-4 sm:px-5 py-3 border-2 border-slate-700 bg-slate-900/80 text-xs text-slate-400 shadow-lg"},ds={class:"flex items-center gap-2.5"},cs=["src"],fs={class:"flex items-center gap-2.5"},ps=["src"],us={class:"flex flex-wrap items-center gap-4 sm:gap-6 font-mono text-[11px] tracking-wide"},hs={class:"flex flex-col items-center leading-none gap-1"},bs={class:"text-slate-200 font-bold text-sm"},ms={class:"flex flex-col items-center leading-none gap-1"},gs={class:"text-emerald-400 font-bold text-sm"},vs={class:"flex flex-col items-center leading-none gap-1"},xs={class:"text-rose-400 font-bold text-sm"},ys={class:"border-4 border-slate-700 bg-slate-950 flex flex-col overflow-hidden min-h-0 shadow-xl pixel-box"},ws={class:"p-4 border-b-4 border-slate-800 bg-slate-900 flex items-center justify-between"},_s={class:"text-[10px] font-mono text-slate-400 bg-slate-950 px-2 py-1 border border-slate-700 font-bold"},ks=["id","onClick"],Cs={key:0,class:"absolute left-0 top-0 bottom-0 w-1 bg-amber-500"},Ms={class:"flex items-center justify-between mb-2 opacity-80 group-hover:opacity-100 pl-2"},Ss={class:"font-bold text-amber-100 font-mono tracking-tight uppercase"},Is={key:0,class:"text-[10px] text-slate-500 font-bold"},Ts={class:"space-y-1.5 pl-2"},zs={key:0,class:"flex items-baseline gap-1.5 flex-wrap leading-relaxed"},Ps={class:"text-emerald-400 font-bold"},Os={class:"text-rose-400 font-bold"},Es={key:0,class:"text-[9px] text-slate-900 bg-amber-500 font-bold uppercase px-1"},As={key:1,class:"flex items-center gap-2 p-1 bg-rose-950/30 border border-rose-900/50 mt-1"},Rs={class:"flex flex-col"},Ls={class:"text-rose-300 font-bold"},Ns={key:2,class:"text-emerald-500/60 italic text-[11px] font-bold"},$e=64,we=32,He=24,Xs=ht({__name:"MatchViewer",setup(Ys){const D={BG_DUNGEON:"https://vibemedia.space/bg_dungeon_v2_99283.png?prompt=dark%20dungeon%20floor%20tile%20texture%20seamless&style=pixel_game_asset&key=NOGON",CHAR_HERO:"https://vibemedia.space/hero_knight_v2_88441.png?prompt=fantasy%20knight%20character%20sprite%20standing%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",CHAR_ENEMY:"https://vibemedia.space/enemy_slime_v2_99223.png?prompt=cute%20slime%20monster%20sprite%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",ICON_SWORD:"https://vibemedia.space/icon_sword_px_11223.png?prompt=pixel%20art%20sword%20icon&style=pixel_game_asset&key=NOGON",ICON_SKULL:"https://vibemedia.space/icon_skull_px_99887.png?prompt=pixel%20art%20skull%20icon&style=pixel_game_asset&key=NOGON",ICON_TROPHY:"https://vibemedia.space/trophy_icon_4d5e6f_v1.png?prompt=golden%20trophy%20pixel%20art&style=pixel_game_asset&key=NOGON",TEX_FLOOR:"https://vibemedia.space/floor_cobble_7a8b9c_v1.png?prompt=cobblestone%20texture%20with%20worn%20stones%20and%20dirt%20between%20cracks&style=pixel_game_asset&key=NOGON",TEX_WALL:"https://vibemedia.space/wall_stone_1x2y3z_v1.png?prompt=stone%20brick%20texture%20with%20weathered%20gray%20surface%20and%20moss%20details&style=pixel_game_asset&key=NOGON"},Z=bt(),J=It(),j=Tt(),We=_t(),B=A(We.params.id),R=A(null),G=A([]),le=A(!1);let F=null;const ne=A(null),$=A({}),re={},_e=A(!1),Be=()=>{let e=0;const t=Object.keys(D).length;Object.entries(D).forEach(([s,a])=>{const i=new Image;i.src=a,i.onload=()=>{e++,e===t&&(_e.value=!0)},re[s]=i})},d=kt({x:0,y:0,zoom:1,shakeX:0,shakeY:0,isDragging:!1,lastX:0,lastY:0}),ie=A([]),S=A(0),L=A(!1),U=A(1);let N=0,Q=null;const ee=A(null),V=(e,t)=>{if(!(!e||typeof e!="object"))return e[t]},te=e=>typeof e!="string"?"--":e.substring(0,6),Fe=q(()=>R.value==="running"?"bg-amber-950 text-amber-500 border-amber-700":R.value==="completed"?"bg-slate-950 text-slate-500 border-slate-700":"bg-emerald-950 text-emerald-500 border-emerald-700"),w=q(()=>G.value.map(e=>e.round)),ke=q(()=>w.value.length?(w.value.indexOf(S.value)+1)/w.value.length*100:0),de=q(()=>{const e=$.value[S.value];if(!e)return{total:0,alive:0,fallen:0};const t=Object.values(e.entities);return{total:t.length,alive:t.filter(s=>s.alive).length,fallen:t.filter(s=>!s.alive).length}}),Ue=(e,t)=>{const s=(e-t)*$e*.5,a=(e+t)*we*.5;return{x:s,y:a}},H=(e,t,s,a)=>{const i=Ue(e,t),c=s/2,l=a/4;return{x:c+i.x*d.zoom+d.x+d.shakeX,y:l+i.y*d.zoom+d.y+d.shakeY}},Ke=e=>{d.shakeX=(Math.random()-.5)*e,d.shakeY=(Math.random()-.5)*e},qe=e=>{d.isDragging=!0,d.lastX=e.clientX,d.lastY=e.clientY},Ze=e=>{if(!d.isDragging)return;const t=e.clientX-d.lastX,s=e.clientY-d.lastY;d.x+=t,d.y+=s,d.lastX=e.clientX,d.lastY=e.clientY},Ce=()=>{d.isDragging=!1},Je=e=>{const t=-Math.sign(e.deltaY)*.1;ce(t)},ce=e=>{d.zoom=Math.max(.2,Math.min(3,d.zoom+e))},fe={top:"#1e293b",side:"#0f172a",stroke:"#334155"},Qe=(e,t,s,a,i,c)=>{const l=H(t,s,a,i),r=d.zoom,f=$e*r,n=we*r,I=(Math.sin(t*.5)+Math.cos(s*.5))*2*r,h=l.y-I,b=8*r;e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x+f/2,h+n/2+b),e.lineTo(l.x,h+n+b),e.fillStyle=fe.side,e.fill(),e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.lineTo(l.x-f/2,h+n/2+b),e.lineTo(l.x,h+n+b),e.fillStyle="#020617",e.fill(),e.beginPath(),e.moveTo(l.x,h),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.closePath(),e.save(),e.clip(),_e.value&&re.TEX_FLOOR?(e.drawImage(re.TEX_FLOOR,l.x-f/2,h,f,n),e.fillStyle="rgba(30, 41, 59, 0.4)",e.fill()):(e.fillStyle=fe.top,e.fill()),(t+s*7)%5===0&&(e.fillStyle="rgba(255, 255, 255, 0.1)",e.fill()),e.restore(),e.strokeStyle=fe.stroke,e.lineWidth=1*r,e.stroke()},pe=(e,t,s)=>{const a=Math.cos(s),i=Math.sin(s);return{x:e*a-t*i,y:e*i+t*a}},ue=(e,t)=>{const s=parseInt(e.slice(1),16),a=t<0?0:255,i=t<0?t*-1:t,c=s>>16,l=s>>8&255,r=s&255;return"#"+(16777216+(Math.round((a-c)*i)+c)*65536+(Math.round((a-l)*i)+l)*256+(Math.round((a-r)*i)+r)).toString(16).slice(1)},et=(e,t,s,a,i,c,l,r,f,n,I,h)=>{const b=i/2,m=c/2,p=[{x:b,y:m},{x:-b,y:m},{x:-b,y:-m},{x:b,y:-m}],_=p.map(x=>{const O=pe(x.x,x.y,r);return{x:t+O.x,y:s+O.y,z:a+l}}),T=p.map(x=>{const O=pe(x.x,x.y,r);return{x:t+O.x,y:s+O.y,z:a}}),v=x=>{const O=H(x.x,x.y,I,h);return{x:O.x,y:O.y-x.z*we*n}},u=_.map(v),y=T.map(v);e.fillStyle=ue(f,.1),e.beginPath(),e.moveTo(u[0].x,u[0].y);for(let x=1;x<4;x++)e.lineTo(u[x].x,u[x].y);e.closePath(),e.fill(),e.strokeStyle=ue(f,-.2),e.lineWidth=1,e.stroke();let g=0,k=u[0].y;for(let x=1;x<4;x++)u[x].y>k&&(k=u[x].y,g=x);const E=(x,O,W)=>{e.fillStyle=ue(f,W),e.beginPath(),e.moveTo(u[x].x,u[x].y),e.lineTo(u[O].x,u[O].y),e.lineTo(y[O].x,y[O].y),e.lineTo(y[x].x,y[x].y),e.closePath(),e.fill(),e.stroke()};E(g,(g+1)%4,-.3),E(g,(g+3)%4,-.1)},tt=(e,t,s,a,i,c,l,r,f,n,I,h,b)=>{const m=i?{head:"#fbbf24",body:"#3b82f6",leg:"#1e3a8a",arm:"#93c5fd"}:{head:"#4ade80",body:"#166534",leg:"#14532d",arm:"#86efac"};b&&(m.head="#ffffff",m.body="#ffffff",m.leg="#ffffff",m.arm="#ffffff");const _=c?Math.sin(n*.01):0,T=_*.5;let v=-_*.5,u=_*.5;if(l){const z=Math.sin(n*.03);u=-Math.PI/2+z*.5}const y=0+a*.01,g=[],k=.25,E=.25,x=.12,O=.3,W=.08,oe=.08,X=.3,he=y+X;g.push({cx:0,cy:0,cz:he,w:E,d:x,h:O,offsetVec:{x:0,y:0,z:0},color:m.body}),g.push({cx:0,cy:0,cz:he+O,w:k,d:k,h:k,offsetVec:{x:0,y:0,z:Math.sin(n*.002)*.02},color:m.head});const Oe=.06;g.push({cx:0,cy:Oe,cz:y,w:W,d:oe,h:X,offsetVec:{x:Math.sin(T)*.1,y:0,z:0},color:m.leg}),g.push({cx:0,cy:-Oe,cz:y,w:W,d:oe,h:X,offsetVec:{x:Math.sin(-T)*.1,y:0,z:0},color:m.leg});const be=he+O-.05,me=.16;if(g.push({cx:0,cy:me,cz:be-X,w:W,d:oe,h:X,offsetVec:{x:Math.sin(v)*.1,y:0,z:Math.cos(v)*.1-.1},color:m.arm}),g.push({cx:0,cy:-me,cz:be-X,w:W,d:oe,h:X,offsetVec:{x:Math.sin(u)*.2,y:0,z:Math.cos(u)*.1-.1},color:m.arm}),l){const K=Math.sin(u)*.2,ge=be-X+Math.cos(u)*.1-.1;g.push({cx:.1,cy:-me-.05,cz:ge,w:.4,d:.05,h:.05,offsetVec:{x:K+.2,y:0,z:0},color:"#cbd5e1"})}const Ee=g.map(z=>{let K=z.cx+z.offsetVec.x,ge=z.cy+z.offsetVec.y,Ae=z.cz+z.offsetVec.z;const Re=pe(K,ge,r),Le=t+Re.x,Ne=s+Re.y,ut=Le+Ne+Ae*.1;return{...z,wx:Le,wy:Ne,wz:Ae,depth:ut}});Ee.sort((z,K)=>z.depth-K.depth),Ee.forEach(z=>{et(e,z.wx,z.wy,z.wz,z.w,z.d,z.h,r,z.color,f,I,h)})},st=(e,t,s,a,i,c,l,r)=>{const f=H(s,a,i,c),n=d.zoom;if(!t.alive){e.fillStyle="#334155";const k=10*n;e.beginPath(),e.rect(f.x-k/2,f.y,k,k),e.fill();return}const I=Math.sin(l/300+t.floatOffset)*2*n,h=r?.hit?(Math.random()-.5)*5*n:0,b=f.y-12*n+I,m=f.x+h;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(f.x,f.y+14*n,10*n,5*n,0,0,Math.PI*2),e.fill();const p=t.isMoving||!1;let _=0;(t.vx!=null||t.vy!=null)&&(_=Math.atan2(t.vy??0,t.vx??0)),tt(e,s,a,I,t.isPlayer,p,r?.attacking||!1,_,n,l,i,c,r?.hit);const T=Math.max(0,t.hp/t.maxHp),v=24*n,u=4*n,y=m-v/2,g=b-50*n;e.fillStyle="#000",e.fillRect(y-1,g-1,v+2,u+2),e.fillStyle=T>.5?"#10b981":T>.25?"#f59e0b":"#ef4444",e.fillRect(y,g,v*T,u)},ot=(e,t,s,a)=>{for(let i=ie.value.length-1;i>=0;i--){const c=ie.value[i];if(c.life-=a,c.life<=0){ie.value.splice(i,1);continue}c.x+=c.vx*a*.06,c.y+=c.vy*a*.06,c.z+=c.vz*a*.06,c.vz-=.02,c.z<0&&(c.z=0,c.vx*=.5,c.vy*=.5);const l=H(c.x,c.y,t,s),r=d.zoom,f=l.y-c.z*10*r;e.fillStyle=c.color;const n=Math.max(2,c.size*r);e.fillRect(l.x-n/2,f-n/2,n,n)}},at=(e,t,s,a,i)=>{for(const l of t.events.attacks){const r=t.entities[l.attackerId],f=t.entities[l.targetId];if(!r||!f)continue;const n=H(r.x,r.y,s,a),I=H(f.x,f.y,s,a);n.y-=30*d.zoom,I.y-=30*d.zoom;const h=l.isCritical;if(i<.5){const b=i/.5,m=n.x+(I.x-n.x)*b,p=n.y+(I.y-n.y)*b,_=Math.sin(b*Math.PI)*40*d.zoom,T=8*d.zoom,v=m,u=p-_,y=e.createRadialGradient(v-T/3,u-T/3,T/6,v,u,T*1.2);h?(y.addColorStop(0,"#ffffff"),y.addColorStop(.2,"#fef3c7"),y.addColorStop(.5,"#fbbf24"),y.addColorStop(.8,"#d97706"),y.addColorStop(1,"rgba(180, 83, 9, 0)")):(y.addColorStop(0,"#ffffff"),y.addColorStop(.2,"#dbeafe"),y.addColorStop(.5,"#60a5fa"),y.addColorStop(.8,"#2563eb"),y.addColorStop(1,"rgba(30, 64, 175, 0)")),e.save(),e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=15*d.zoom,e.fillStyle=y,e.beginPath(),e.arc(v,u,T,0,Math.PI*2),e.fill(),e.restore();const g=e.createRadialGradient(v,u,0,v,u,T*.4);if(g.addColorStop(0,"rgba(255, 255, 255, 0.9)"),g.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=g,e.beginPath(),e.arc(v,u,T*.4,0,Math.PI*2),e.fill(),b>.1){const k=e.createLinearGradient(n.x,n.y,v,u);h?(k.addColorStop(0,"rgba(251, 191, 36, 0)"),k.addColorStop(.5,"rgba(251, 191, 36, 0.3)"),k.addColorStop(1,"rgba(251, 191, 36, 0.8)")):(k.addColorStop(0,"rgba(96, 165, 250, 0)"),k.addColorStop(.5,"rgba(96, 165, 250, 0.3)"),k.addColorStop(1,"rgba(96, 165, 250, 0.8)")),e.strokeStyle=k,e.lineWidth=3*d.zoom,e.lineCap="round",e.beginPath(),e.moveTo(n.x,n.y),e.quadraticCurveTo(n.x+(I.x-n.x)*.5,n.y+(I.y-n.y)*.5-40*d.zoom,v,u),e.stroke()}}if(i>=.5&&i<.5+.3){const b=(i-.5)/.3,m=I.x,p=I.y-20*d.zoom,_=(h?30:20)*d.zoom*(.3+b*.7),T=1-b;e.save(),e.globalAlpha=T;const v=e.createRadialGradient(m,p,_*.5,m,p,_);if(h?(v.addColorStop(0,"rgba(251, 191, 36, 0)"),v.addColorStop(.6,"rgba(251, 191, 36, 0.8)"),v.addColorStop(.8,"rgba(245, 158, 11, 0.6)"),v.addColorStop(1,"rgba(217, 119, 6, 0)")):(v.addColorStop(0,"rgba(96, 165, 250, 0)"),v.addColorStop(.6,"rgba(96, 165, 250, 0.8)"),v.addColorStop(.8,"rgba(59, 130, 246, 0.6)"),v.addColorStop(1,"rgba(37, 99, 235, 0)")),e.fillStyle=v,e.beginPath(),e.arc(m,p,_,0,Math.PI*2),e.fill(),b<.5){const g=1-b/.5,k=(h?15:10)*d.zoom*(1-b*.5);e.globalAlpha=g,e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=20*d.zoom;const E=e.createRadialGradient(m,p,0,m,p,k);E.addColorStop(0,"#ffffff"),E.addColorStop(.5,h?"#fef3c7":"#dbeafe"),E.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=E,e.beginPath(),e.arc(m,p,k,0,Math.PI*2),e.fill()}const u=h?8:5,y=(h?25:15)*d.zoom*(.5+b*.5);e.globalAlpha=T*.8,e.strokeStyle=h?"#fef3c7":"#dbeafe",e.lineWidth=2*d.zoom,e.lineCap="round";for(let g=0;g<u;g++){const k=Math.PI*2/u*g+b*.5,E=_*.3,x=E+y*(1-b*.5);e.beginPath(),e.moveTo(m+Math.cos(k)*E,p+Math.sin(k)*E),e.lineTo(m+Math.cos(k)*x,p+Math.sin(k)*x),e.stroke()}e.restore()}if(i>=.5){const b=(i-.5)/.5,m=Math.min(1,b*3),_=(1-Math.pow(1-m,3))*60*d.zoom,T=Math.max(0,1-b*1.5);e.save(),e.globalAlpha=T;const v=Math.round((l.isCritical?24:14)*d.zoom);e.font=`bold ${v}px 'Courier New', monospace`,e.textAlign="center";const u=`${l.damage}`,y=I.x,g=I.y-30*d.zoom-_;e.lineWidth=3,e.strokeStyle="black",e.strokeText(u,y,g),e.fillStyle=l.isCritical?"#fbbf24":"#fff",e.fillText(u,y,g),l.isCritical&&(e.font=`bold ${Math.round(10*d.zoom)}px 'Courier New', monospace`,e.fillStyle="#f59e0b",e.fillText("CRIT!",y,g-20*d.zoom)),e.restore()}}},lt=e=>{if(!ne.value)return;const t=ne.value,s=t.getContext("2d");if(!s)return;const a=t.getBoundingClientRect();(t.width!==a.width||t.height!==a.height)&&(t.width=a.width,t.height=a.height),d.shakeX*=.9,d.shakeY*=.9,Math.abs(d.shakeX)<.5&&(d.shakeX=0),Math.abs(d.shakeY)<.5&&(d.shakeY=0);let i=S.value,c=0;if(L.value&&N>0){const p=1e3/U.value;c=Math.min(1,(e-N)/p)}const l=$.value[i];if(!l)return;const r=w.value.indexOf(i)+1,f=w.value[r],n=f?$.value[f]:void 0;s.clearRect(0,0,t.width,t.height);for(let p=0;p<=He;p++)for(let _=0;_<=He;_++)Qe(s,p,_,t.width,t.height);const I=nt(l,n,c),h=new Set,b=new Set;l.events?.attacks&&(c>=.5&&c<.5+.2&&l.events.attacks.forEach(_=>h.add(_.targetId)),c<.4&&l.events.attacks.forEach(_=>b.add(_.attackerId)));const m=Object.values(I).map(p=>({type:"entity",yDepth:p.x+p.y,entity:p,x:p.x,y:p.y,hit:h.has(p.id),attacking:b.has(p.id)}));m.sort((p,_)=>p.yDepth-_.yDepth);for(const p of m)p.type==="entity"&&st(s,p.entity,p.x,p.y,t.width,t.height,e,{hit:p.hit,attacking:p.attacking});ot(s,t.width,t.height,16),at(s,l,t.width,t.height,c)},nt=(e,t,s)=>{if(!t||s<=0)return e.entities;const a={};return new Set([...Object.keys(e.entities),...Object.keys(t.entities)]).forEach(c=>{const l=e.entities[c],r=t.entities[c];if(l&&r){const f=r.x-l.x,n=r.y-l.y,I=s<1&&(Math.abs(f)>.001||Math.abs(n)>.001);a[c]={...l,x:l.x+f*s,y:l.y+n*s,hp:l.hp+(r.hp-l.hp)*s,alive:s<.8?l.alive:r.alive,floatOffset:l.floatOffset,vx:f,vy:n,isMoving:I}}else r?a[c]={...r,isMoving:!1,vx:0,vy:0}:l&&(a[c]={...l,isMoving:!1,vx:0,vy:0})}),a},Me=e=>{if(lt(e),L.value){N||(N=e);const t=1e3/U.value,s=(e-N)/t;if(s>.1&&s<.15&&$.value[S.value]?.events.attacks.some(i=>i.isCritical)&&Ke(2*d.zoom),s>=1){const i=w.value.indexOf(S.value)+1;i>=w.value.length?(L.value=!1,N=0):(S.value=w.value[i],N=e,se(S.value))}}Q=requestAnimationFrame(Me)},Se=e=>{const t=w.value.indexOf(S.value);if(t===-1)return;const s=t+e;s<0||s>=w.value.length||(S.value=w.value[s],se(S.value))},se=e=>{Ct(()=>{const t=document.getElementById("log-round-"+e);if(t&&ee.value){const s=t.offsetTop-ee.value.offsetTop;ee.value.scrollTo({top:s-100,behavior:"smooth"})}})},rt=e=>{if(!w.value.length)return;const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left,a=Math.max(0,Math.min(1,s/t.width)),i=Math.floor(a*(w.value.length-1));S.value=w.value[i],se(S.value)},it=e=>{S.value=e,L.value=!1},dt=()=>{w.value.length<=1||(L.value?L.value=!1:(S.value===w.value[w.value.length-1]&&(S.value=w.value[0]),L.value=!0,N=0))},Ie=q(()=>{if(!J.fighters.length)return!1;const e=new Set(J.fighters.map(s=>s.id)),t=$.value[w.value[w.value.length-1]];return t?Object.values(t.entities).some(s=>e.has(s.id)&&s.alive):!1}),ct=async()=>{try{await j.claimAll(),window.location.href="/matches"}catch(e){console.error("Failed to claim rewards:",e)}},Te=async()=>{if(!(!Z.token||!B.value)){le.value=!0;try{const t=await Ve(`${je.match}/${B.value}/roundticks`,{token:Z.token})||[],s=G.value.length;if(G.value=t,ft(),R.value==="running"&&t.length>s&&t.length>0){const a=t[t.length-1]?.round;a!=null&&(S.value=a,se(a))}}catch(e){console.error(e)}finally{le.value=!1}}},ze=async()=>{if(!(!Z.token||!B.value))try{const e=await Ve(`${je.match}/${B.value}`,{token:Z.token});return R.value=e?.status??null,e?.status}catch{return R.value=null,null}},ft=()=>{const e=new Set(J.fighters.map(a=>a.id)),t=new Map,s={};for(const a of G.value){const i={attacks:[],deaths:[]};for(const l of a.ticks||[]){const r=l.payload;if(r){if(l.type==="spawn"){const f=r.fighterId;t.set(f,{id:f,x:r.x??0,y:r.y??0,hp:r.hp??100,maxHp:r.hp??100,alive:!0,isPlayer:e.has(f),floatOffset:Math.random()*Math.PI*2})}else if(l.type==="move"){const f=r.fighterId,n=t.get(f);n&&(n.x=r.toX??n.x,n.y=r.toY??n.y)}else if(l.type==="attack"){i.attacks.push({attackerId:r.attackerId,targetId:r.targetId,isCritical:r.isCritical,isParried:r.isParried,damage:r.damage});const f=t.get(r.targetId);f&&(f.hp=Math.max(0,f.hp-(r.damage||0)))}else if(l.type==="died"){const f=r.fighterId,n=t.get(f);n&&(n.alive=!1,n.hp=0),i.deaths.push(f)}}}const c={};t.forEach((l,r)=>{c[r]={...l}}),s[a.round]={round:a.round,entities:c,events:i}}$.value=s};function pt(){F||(F=window.setInterval(async()=>{const e=await ze();await Te(),e==="completed"&&Pe()},2500))}function Pe(){F&&(clearInterval(F),F=null)}return mt(async()=>{await J.fetchFighters(),await j.fetchRewards(),Be(),await ze(),await Te(),w.value.length&&(R.value==="completed"?S.value=w.value[0]:S.value=w.value[w.value.length-1]),Q=requestAnimationFrame(Me),R.value==="running"&&pt()}),gt(()=>{Q&&cancelAnimationFrame(Q),Pe()}),(e,t)=>(C(),M("div",{class:"pixel-theme h-dvh max-h-dvh overflow-hidden flex flex-col gap-3 sm:gap-4 font-mono text-slate-200",style:ye({backgroundImage:`url('${D.BG_DUNGEON}')`})},[t[31]||(t[31]=o("div",{class:"fixed inset-0 bg-slate-950/80 pointer-events-none z-0"},null,-1)),o("header",zt,[o("div",Pt,[Xe(St,{variant:"ghost",size:"sm",onClick:t[0]||(t[0]=s=>e.$router.push("/matches")),"class-name":"rpg-btn-small"},{default:Ye(()=>[...t[7]||(t[7]=[ve(" ← BACK ",-1)])]),_:1}),o("div",null,[o("h1",Ot,[ve(" BATTLE LOG #"+P(B.value?.substring(0,8))+" ",1),R.value?(C(),M("span",{key:0,class:xe(["px-2 py-0.5 text-xs font-bold uppercase tracking-wider border-2",Fe.value])},P(R.value),3)):Y("",!0)])])]),R.value==="running"?(C(),M("div",Et,[...t[8]||(t[8]=[o("span",{class:"relative flex h-2 w-2"},[o("span",{class:"animate-ping absolute inline-flex h-full w-full bg-amber-400 opacity-75"}),o("span",{class:"relative inline-flex h-2 w-2 bg-amber-500"})],-1),o("span",{class:"text-xs font-bold text-amber-400 uppercase tracking-widest blink"},"LIVE FEED",-1)])])):Y("",!0)]),o("div",At,[o("div",Rt,[o("div",Lt,[le.value?(C(),M("div",Nt,[...t[9]||(t[9]=[o("div",{class:"flex flex-col items-center gap-3"},[o("div",{class:"h-8 w-8 animate-spin border-4 border-amber-500 border-t-transparent"}),o("p",{class:"text-amber-200 text-sm font-bold uppercase tracking-wider"},"Loading battle data...")],-1)])])):G.value.length?Y("",!0):(C(),M("div",Xt,[...t[10]||(t[10]=[o("p",{class:"text-slate-500 font-bold uppercase tracking-wider"},"Waiting for battle data...",-1)])])),o("canvas",{ref_key:"canvasRef",ref:ne,class:"w-full h-full object-cover cursor-move pixelated",onMousedown:qe,onMousemove:Ze,onMouseup:Ce,onMouseleave:Ce,onWheel:vt(Je,["prevent"])},null,544),t[16]||(t[16]=o("div",{class:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"},null,-1)),t[17]||(t[17]=o("div",{class:"absolute inset-0 pointer-events-none opacity-10 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-size-[100%_4px]"},null,-1)),Xe(xt,{name:"fade"},{default:Ye(()=>[R.value==="completed"&&w.value.length&&S.value===w.value[w.value.length-1]?(C(),M("div",Yt,[o("div",Dt,[Ie.value?(C(),M("img",{key:0,src:D.ICON_TROPHY,class:"w-16 h-16 mx-auto mb-2 pixelated animate-bounce-slow"},null,8,Gt)):(C(),M("img",{key:1,src:D.ICON_SKULL,class:"w-16 h-16 mx-auto mb-2 pixelated opacity-50"},null,8,Vt)),Ie.value?(C(),M("h2",jt,"VICTORY")):(C(),M("h2",$t,"DEFEAT")),o("div",Ht,[t[13]||(t[13]=o("h3",{class:"text-xs font-bold text-slate-500 uppercase mb-3 text-shadow-retro"},"Rewards available to claim",-1)),ae(j).rewardCount>0?(C(),M("div",Wt,[o("div",Bt,[t[11]||(t[11]=o("span",{class:"text-slate-400"},"Match Bonus:",-1)),o("span",Ft,"+ "+P(ae(j).rewardCount*20)+" Particles",1)]),o("button",{class:"rpg-btn-small mt-2 w-full !bg-amber-600 !text-slate-900 border-amber-800 hover:!bg-amber-500 font-bold",onClick:ct,disabled:ae(j).isLoading},P(ae(j).isLoading?"CLAIMING...":"CLAIM & EXIT"),9,Ut)])):(C(),M("div",Kt,[t[12]||(t[12]=o("p",{class:"text-slate-500 text-xs italic"},"All rewards claimed or none earned.",-1)),o("button",{class:"rpg-btn-small mt-3 w-full font-bold",onClick:t[1]||(t[1]=s=>e.$router.push("/matches"))},"EXIT TO MAP")]))])])])):Y("",!0)]),_:1}),o("div",qt,[o("div",{class:"relative h-4 bg-slate-950 border-2 border-slate-700 cursor-pointer group/bar",onClick:rt},[o("div",{class:"absolute inset-y-0 left-0 bg-amber-600 transition-all duration-100",style:ye({width:ke.value+"%"})},null,4),o("div",{class:"absolute inset-y-0 w-2 bg-white opacity-0 group-hover/bar:opacity-100 transition-opacity",style:ye({left:ke.value+"%"})},null,4)]),o("div",Zt,[o("div",Jt,[o("button",{onClick:dt,class:"rpg-btn-small bg-amber-600 border-amber-800 text-slate-900 hover:bg-amber-500 font-black h-10 w-10 flex items-center justify-center"},[L.value?(C(),M("span",Qt,"||")):(C(),M("span",es,">"))]),o("div",ts,[o("button",{onClick:t[2]||(t[2]=s=>Se(-1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},"<<"),o("span",ss,"RND "+P(S.value),1),o("button",{onClick:t[3]||(t[3]=s=>Se(1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},">>")])]),o("div",os,[o("div",as,[t[14]||(t[14]=o("span",{class:"uppercase font-bold"},"SPD",-1)),yt(o("input",{type:"range",min:"0.5",max:"4",step:"0.5","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s),class:"w-20 accent-amber-500 h-2 bg-slate-800 appearance-none cursor-pointer"},null,512),[[wt,U.value,void 0,{number:!0}]]),o("span",ls,P(U.value)+"x",1)]),o("div",ns,[t[15]||(t[15]=o("span",{class:"uppercase font-bold"},"ZM",-1)),o("button",{onClick:t[5]||(t[5]=s=>ce(-.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"-"),o("span",rs,P(Math.round(d.zoom*100))+"%",1),o("button",{onClick:t[6]||(t[6]=s=>ce(.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"+")])])])])]),o("div",is,[o("div",ds,[o("img",{src:D.ICON_SWORD,class:"w-4 h-4 pixelated"},null,8,cs),t[18]||(t[18]=o("span",{class:"font-bold text-emerald-200 uppercase"},"Heroes",-1))]),o("div",fs,[o("img",{src:D.ICON_SKULL,class:"w-4 h-4 pixelated"},null,8,ps),t[19]||(t[19]=o("span",{class:"font-bold text-rose-200 uppercase"},"Enemies",-1))]),t[25]||(t[25]=o("div",{class:"flex-1 hidden sm:block"},null,-1)),o("div",us,[o("div",hs,[t[20]||(t[20]=o("span",{class:"text-slate-500 font-bold uppercase"},"TOTAL",-1)),o("span",bs,P(de.value.total),1)]),t[23]||(t[23]=o("div",{class:"w-px h-6 bg-slate-700"},null,-1)),o("div",ms,[t[21]||(t[21]=o("span",{class:"text-emerald-500/70 font-bold uppercase"},"ALIVE",-1)),o("span",gs,P(de.value.alive),1)]),t[24]||(t[24]=o("div",{class:"w-px h-6 bg-slate-700"},null,-1)),o("div",vs,[t[22]||(t[22]=o("span",{class:"text-rose-500/70 font-bold uppercase"},"FALLEN",-1)),o("span",xs,P(de.value.fallen),1)])])])]),o("div",ys,[o("div",ws,[t[26]||(t[26]=o("h3",{class:"font-bold text-amber-500 text-sm uppercase tracking-wider flex items-center gap-2"},[o("span",{class:"w-2 h-2 bg-amber-500 animate-pulse"}),ve(" Combat Log ")],-1)),o("span",_s,P(G.value.length)+" TICKS",1)]),o("div",{class:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar scroll-smooth bg-[#020617]",ref_key:"logsContainer",ref:ee},[(C(!0),M(De,null,Ge(G.value,s=>(C(),M("div",{key:s.round,id:"log-round-"+s.round,onClick:a=>it(s.round),class:xe(["border-2 p-3 text-xs transition-all cursor-pointer group relative overflow-hidden",s.round===S.value?"border-amber-600 bg-amber-900/20":"border-slate-800 hover:border-slate-600 hover:bg-slate-900"])},[s.round===S.value?(C(),M("div",Cs)):Y("",!0),o("div",Ms,[o("span",Ss,"ROUND "+P(s.round.toString().padStart(2,"0")),1),s.ticks?.length?(C(),M("span",Is,P(s.ticks.length)+" EVENTS",1)):Y("",!0)]),o("div",Ts,[(C(!0),M(De,null,Ge(s.ticks,(a,i)=>(C(),M("div",{key:i,class:"pl-3 border-l-2 border-slate-800 py-0.5 relative"},[t[30]||(t[30]=o("div",{class:"absolute -left-[5px] top-2 w-[8px] h-[8px] bg-slate-800 border border-slate-600 rotate-45"},null,-1)),a.type==="attack"?(C(),M("div",zs,[o("span",Ps,P(te(V(a.payload,"attackerId"))),1),t[27]||(t[27]=o("span",{class:"text-slate-600 text-[10px] uppercase font-bold tracking-wider"},"HIT",-1)),o("span",Os,P(te(V(a.payload,"targetId"))),1),o("span",{class:xe(["font-mono font-bold ml-1",V(a.payload,"isCritical")?"text-amber-400 text-sm":"text-slate-300"])}," -"+P(V(a.payload,"damage")),3),V(a.payload,"isCritical")?(C(),M("span",Es,"CRIT")):Y("",!0)])):a.type==="died"?(C(),M("div",As,[t[29]||(t[29]=o("span",{class:"text-rose-500 text-lg"},"☠",-1)),o("div",Rs,[t[28]||(t[28]=o("span",{class:"text-rose-500 font-bold uppercase text-[10px] tracking-wide"},"SLAIN",-1)),o("span",Ls,P(te(V(a.payload,"fighterId"))),1)])])):a.type==="spawn"?(C(),M("div",Ns," ✨ "+P(te(V(a.payload,"fighterId")))+" APPEARED ",1)):Y("",!0)]))),128))])],10,ks))),128))],512)])])],4))}}),$s=Mt(Xs,[["__scopeId","data-v-f1b0fc0a"]]);export{$s as default};
