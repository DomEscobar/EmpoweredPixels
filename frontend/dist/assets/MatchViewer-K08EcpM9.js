import{d as ct,u as ft,l as R,y as pt,z as ut,o as T,c as z,a as o,g as Ae,w as Ne,b as ge,t as O,n as be,j as X,k as ht,T as gt,q as me,i as bt,v as mt,F as Le,s as Ye,I as vt,J as yt,x as te,K as xt,C as Xe,D as De,_ as wt}from"./index-Cwji7ajR.js";import{_ as _t}from"./BaseButton.vue_vue_type_script_setup_true_lang-Dh__-Yag.js";import{u as kt}from"./store-CAy-Ahly.js";const Ct={class:"relative z-10 flex flex-col sm:flex-row sm:items-center justify-between shrink-0 p-3 sm:p-4 border-b-4 border-amber-900/50 bg-slate-900/80 gap-3 sm:gap-4"},Mt={class:"flex items-center gap-3 sm:gap-4 min-w-0"},St={class:"text-lg sm:text-2xl font-black tracking-tight text-amber-500 flex flex-wrap items-center gap-2 sm:gap-3 uppercase text-shadow-retro"},It={key:0,class:"flex items-center gap-2 px-3 py-1 bg-black/60 border border-amber-500/50"},Tt={class:"relative z-10 flex-1 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 min-h-0 px-3 sm:px-4 pb-3 sm:pb-4 overflow-y-auto lg:overflow-hidden"},zt={class:"lg:col-span-2 flex flex-col gap-3 sm:gap-4 min-h-0 min-w-0"},Pt={class:"relative flex-1 min-h-[45vh] sm:min-h-[55vh] border-4 border-slate-700 bg-[#020617] overflow-hidden shadow-2xl flex flex-col group pixel-box"},Ot={key:0,class:"absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm"},Et={key:1,class:"absolute inset-0 z-10 flex items-center justify-center"},Rt={key:0,class:"absolute inset-0 pointer-events-none flex items-center justify-center bg-black/70 backdrop-blur-[2px]"},At={class:"text-center transform scale-100 animate-in zoom-in duration-500 border-4 border-amber-500 bg-slate-900 p-8 pixel-box"},Nt=["src"],Lt={class:"absolute bottom-0 inset-x-0 bg-slate-900/90 border-t-4 border-slate-700 p-3 sm:p-4 flex flex-col gap-3 transition-opacity duration-300 opacity-0 group-hover:opacity-100"},Yt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-1 gap-3"},Xt={class:"flex items-center gap-3 sm:gap-4"},Dt={key:0},Gt={key:1,class:"ml-1"},Vt={class:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},jt={class:"text-xs font-mono text-amber-400 w-20 text-center font-bold"},Ht={class:"flex flex-wrap items-center gap-3 sm:gap-4"},$t={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},Wt={class:"w-8 text-right text-amber-200 font-mono font-bold"},Bt={class:"flex items-center gap-2 text-xs text-slate-400 bg-slate-950 px-3 py-1.5 border-2 border-slate-700"},Ft={class:"w-10 text-center font-mono font-bold"},Ut={class:"flex flex-wrap items-center gap-3 sm:gap-6 px-4 sm:px-5 py-3 border-2 border-slate-700 bg-slate-900/80 text-xs text-slate-400 shadow-lg"},qt={class:"flex items-center gap-2.5"},Kt=["src"],Zt={class:"flex items-center gap-2.5"},Jt=["src"],Qt={class:"flex flex-wrap items-center gap-4 sm:gap-6 font-mono text-[11px] tracking-wide"},es={class:"flex flex-col items-center leading-none gap-1"},ts={class:"text-slate-200 font-bold text-sm"},ss={class:"flex flex-col items-center leading-none gap-1"},os={class:"text-emerald-400 font-bold text-sm"},as={class:"flex flex-col items-center leading-none gap-1"},ls={class:"text-rose-400 font-bold text-sm"},ns={class:"border-4 border-slate-700 bg-slate-950 flex flex-col overflow-hidden min-h-0 shadow-xl pixel-box"},rs={class:"p-4 border-b-4 border-slate-800 bg-slate-900 flex items-center justify-between"},is={class:"text-[10px] font-mono text-slate-400 bg-slate-950 px-2 py-1 border border-slate-700 font-bold"},ds=["id","onClick"],cs={key:0,class:"absolute left-0 top-0 bottom-0 w-1 bg-amber-500"},fs={class:"flex items-center justify-between mb-2 opacity-80 group-hover:opacity-100 pl-2"},ps={class:"font-bold text-amber-100 font-mono tracking-tight uppercase"},us={key:0,class:"text-[10px] text-slate-500 font-bold"},hs={class:"space-y-1.5 pl-2"},gs={key:0,class:"flex items-baseline gap-1.5 flex-wrap leading-relaxed"},bs={class:"text-emerald-400 font-bold"},ms={class:"text-rose-400 font-bold"},vs={key:0,class:"text-[9px] text-slate-900 bg-amber-500 font-bold uppercase px-1"},ys={key:1,class:"flex items-center gap-2 p-1 bg-rose-950/30 border border-rose-900/50 mt-1"},xs={class:"flex flex-col"},ws={class:"text-rose-300 font-bold"},_s={key:2,class:"text-emerald-500/60 italic text-[11px] font-bold"},Ge=64,ve=32,Ve=24,ks=ct({__name:"MatchViewer",setup(Cs){const V={BG_DUNGEON:"https://vibemedia.space/bg_dungeon_v2_99283.png?prompt=dark%20dungeon%20floor%20tile%20texture%20seamless&style=pixel_game_asset&key=NOGON",CHAR_HERO:"https://vibemedia.space/hero_knight_v2_88441.png?prompt=fantasy%20knight%20character%20sprite%20standing%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",CHAR_ENEMY:"https://vibemedia.space/enemy_slime_v2_99223.png?prompt=cute%20slime%20monster%20sprite%20pixel%20art%20front%20view&style=pixel_game_asset&key=NOGON",ICON_SWORD:"https://vibemedia.space/icon_sword_px_11223.png?prompt=pixel%20art%20sword%20icon&style=pixel_game_asset&key=NOGON",ICON_SKULL:"https://vibemedia.space/icon_skull_px_99887.png?prompt=pixel%20art%20skull%20icon&style=pixel_game_asset&key=NOGON",ICON_TROPHY:"https://vibemedia.space/trophy_icon_4d5e6f_v1.png?prompt=golden%20trophy%20pixel%20art&style=pixel_game_asset&key=NOGON",TEX_FLOOR:"https://vibemedia.space/floor_cobble_7a8b9c_v1.png?prompt=cobblestone%20texture%20with%20worn%20stones%20and%20dirt%20between%20cracks&style=pixel_game_asset&key=NOGON",TEX_WALL:"https://vibemedia.space/wall_stone_1x2y3z_v1.png?prompt=stone%20brick%20texture%20with%20weathered%20gray%20surface%20and%20moss%20details&style=pixel_game_asset&key=NOGON"},q=ft(),ye=kt(),je=vt(),$=R(je.params.id),A=R(null),D=R([]),se=R(!1);let W=null;const oe=R(null),B=R({}),ae={},xe=R(!1),He=()=>{let e=0;const t=Object.keys(V).length;Object.entries(V).forEach(([s,a])=>{const i=new Image;i.src=a,i.onload=()=>{e++,e===t&&(xe.value=!0)},ae[s]=i})},d=yt({x:0,y:0,zoom:1,shakeX:0,shakeY:0,isDragging:!1,lastX:0,lastY:0}),le=R([]),C=R(0),N=R(!1),F=R(1);let L=0,K=null;const Z=R(null),G=(e,t)=>{if(!(!e||typeof e!="object"))return e[t]},J=e=>typeof e!="string"?"--":e.substring(0,6),$e=te(()=>A.value==="running"?"bg-amber-950 text-amber-500 border-amber-700":A.value==="completed"?"bg-slate-950 text-slate-500 border-slate-700":"bg-emerald-950 text-emerald-500 border-emerald-700"),k=te(()=>D.value.map(e=>e.round)),we=te(()=>k.value.length?(k.value.indexOf(C.value)+1)/k.value.length*100:0),ne=te(()=>{const e=B.value[C.value];if(!e)return{total:0,alive:0,fallen:0};const t=Object.values(e.entities);return{total:t.length,alive:t.filter(s=>s.alive).length,fallen:t.filter(s=>!s.alive).length}}),We=(e,t)=>{const s=(e-t)*Ge*.5,a=(e+t)*ve*.5;return{x:s,y:a}},j=(e,t,s,a)=>{const i=We(e,t),c=s/2,l=a/4;return{x:c+i.x*d.zoom+d.x+d.shakeX,y:l+i.y*d.zoom+d.y+d.shakeY}},Be=e=>{d.shakeX=(Math.random()-.5)*e,d.shakeY=(Math.random()-.5)*e},Fe=e=>{d.isDragging=!0,d.lastX=e.clientX,d.lastY=e.clientY},Ue=e=>{if(!d.isDragging)return;const t=e.clientX-d.lastX,s=e.clientY-d.lastY;d.x+=t,d.y+=s,d.lastX=e.clientX,d.lastY=e.clientY},_e=()=>{d.isDragging=!1},qe=e=>{const t=-Math.sign(e.deltaY)*.1;re(t)},re=e=>{d.zoom=Math.max(.2,Math.min(3,d.zoom+e))},ie={top:"#1e293b",side:"#0f172a",stroke:"#334155"},Ke=(e,t,s,a,i,c)=>{const l=j(t,s,a,i),r=d.zoom,f=Ge*r,n=ve*r,M=(Math.sin(t*.5)+Math.cos(s*.5))*2*r,h=l.y-M,g=8*r;e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x+f/2,h+n/2+g),e.lineTo(l.x,h+n+g),e.fillStyle=ie.side,e.fill(),e.beginPath(),e.moveTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.lineTo(l.x-f/2,h+n/2+g),e.lineTo(l.x,h+n+g),e.fillStyle="#020617",e.fill(),e.beginPath(),e.moveTo(l.x,h),e.lineTo(l.x+f/2,h+n/2),e.lineTo(l.x,h+n),e.lineTo(l.x-f/2,h+n/2),e.closePath(),e.save(),e.clip(),xe.value&&ae.TEX_FLOOR?(e.drawImage(ae.TEX_FLOOR,l.x-f/2,h,f,n),e.fillStyle="rgba(30, 41, 59, 0.4)",e.fill()):(e.fillStyle=ie.top,e.fill()),(t+s*7)%5===0&&(e.fillStyle="rgba(255, 255, 255, 0.1)",e.fill()),e.restore(),e.strokeStyle=ie.stroke,e.lineWidth=1*r,e.stroke()},de=(e,t,s)=>{const a=Math.cos(s),i=Math.sin(s);return{x:e*a-t*i,y:e*i+t*a}},ce=(e,t)=>{const s=parseInt(e.slice(1),16),a=t<0?0:255,i=t<0?t*-1:t,c=s>>16,l=s>>8&255,r=s&255;return"#"+(16777216+(Math.round((a-c)*i)+c)*65536+(Math.round((a-l)*i)+l)*256+(Math.round((a-r)*i)+r)).toString(16).slice(1)},Ze=(e,t,s,a,i,c,l,r,f,n,M,h)=>{const g=i/2,b=c/2,p=[{x:g,y:b},{x:-g,y:b},{x:-g,y:-b},{x:g,y:-b}],w=p.map(y=>{const P=de(y.x,y.y,r);return{x:t+P.x,y:s+P.y,z:a+l}}),S=p.map(y=>{const P=de(y.x,y.y,r);return{x:t+P.x,y:s+P.y,z:a}}),v=y=>{const P=j(y.x,y.y,M,h);return{x:P.x,y:P.y-y.z*ve*n}},u=w.map(v),x=S.map(v);e.fillStyle=ce(f,.1),e.beginPath(),e.moveTo(u[0].x,u[0].y);for(let y=1;y<4;y++)e.lineTo(u[y].x,u[y].y);e.closePath(),e.fill(),e.strokeStyle=ce(f,-.2),e.lineWidth=1,e.stroke();let m=0,_=u[0].y;for(let y=1;y<4;y++)u[y].y>_&&(_=u[y].y,m=y);const E=(y,P,H)=>{e.fillStyle=ce(f,H),e.beginPath(),e.moveTo(u[y].x,u[y].y),e.lineTo(u[P].x,u[P].y),e.lineTo(x[P].x,x[P].y),e.lineTo(x[y].x,x[y].y),e.closePath(),e.fill(),e.stroke()};E(m,(m+1)%4,-.3),E(m,(m+3)%4,-.1)},Je=(e,t,s,a,i,c,l,r,f,n,M,h,g)=>{const b=i?{head:"#fbbf24",body:"#3b82f6",leg:"#1e3a8a",arm:"#93c5fd"}:{head:"#4ade80",body:"#166534",leg:"#14532d",arm:"#86efac"};g&&(b.head="#ffffff",b.body="#ffffff",b.leg="#ffffff",b.arm="#ffffff");const w=c?Math.sin(n*.01):0,S=w*.5;let v=-w*.5,u=w*.5;if(l){const I=Math.sin(n*.03);u=-Math.PI/2+I*.5}const x=0+a*.01,m=[],_=.25,E=.25,y=.12,P=.3,H=.08,ee=.08,Y=.3,fe=x+Y;m.push({cx:0,cy:0,cz:fe,w:E,d:y,h:P,offsetVec:{x:0,y:0,z:0},color:b.body}),m.push({cx:0,cy:0,cz:fe+P,w:_,d:_,h:_,offsetVec:{x:0,y:0,z:Math.sin(n*.002)*.02},color:b.head});const Te=.06;m.push({cx:0,cy:Te,cz:x,w:H,d:ee,h:Y,offsetVec:{x:Math.sin(S)*.1,y:0,z:0},color:b.leg}),m.push({cx:0,cy:-Te,cz:x,w:H,d:ee,h:Y,offsetVec:{x:Math.sin(-S)*.1,y:0,z:0},color:b.leg});const pe=fe+P-.05,ue=.16;if(m.push({cx:0,cy:ue,cz:pe-Y,w:H,d:ee,h:Y,offsetVec:{x:Math.sin(v)*.1,y:0,z:Math.cos(v)*.1-.1},color:b.arm}),m.push({cx:0,cy:-ue,cz:pe-Y,w:H,d:ee,h:Y,offsetVec:{x:Math.sin(u)*.2,y:0,z:Math.cos(u)*.1-.1},color:b.arm}),l){const U=Math.sin(u)*.2,he=pe-Y+Math.cos(u)*.1-.1;m.push({cx:.1,cy:-ue-.05,cz:he,w:.4,d:.05,h:.05,offsetVec:{x:U+.2,y:0,z:0},color:"#cbd5e1"})}const ze=m.map(I=>{let U=I.cx+I.offsetVec.x,he=I.cy+I.offsetVec.y,Pe=I.cz+I.offsetVec.z;const Oe=de(U,he,r),Ee=t+Oe.x,Re=s+Oe.y,dt=Ee+Re+Pe*.1;return{...I,wx:Ee,wy:Re,wz:Pe,depth:dt}});ze.sort((I,U)=>I.depth-U.depth),ze.forEach(I=>{Ze(e,I.wx,I.wy,I.wz,I.w,I.d,I.h,r,I.color,f,M,h)})},Qe=(e,t,s,a,i,c,l,r)=>{const f=j(s,a,i,c),n=d.zoom;if(!t.alive){e.fillStyle="#334155";const _=10*n;e.beginPath(),e.rect(f.x-_/2,f.y,_,_),e.fill();return}const M=Math.sin(l/300+t.floatOffset)*2*n,h=r?.hit?(Math.random()-.5)*5*n:0,g=f.y-12*n+M,b=f.x+h;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(f.x,f.y+14*n,10*n,5*n,0,0,Math.PI*2),e.fill();const p=t.isMoving||!1;let w=0;(t.vx!=null||t.vy!=null)&&(w=Math.atan2(t.vy??0,t.vx??0)),Je(e,s,a,M,t.isPlayer,p,r?.attacking||!1,w,n,l,i,c,r?.hit);const S=Math.max(0,t.hp/t.maxHp),v=24*n,u=4*n,x=b-v/2,m=g-50*n;e.fillStyle="#000",e.fillRect(x-1,m-1,v+2,u+2),e.fillStyle=S>.5?"#10b981":S>.25?"#f59e0b":"#ef4444",e.fillRect(x,m,v*S,u)},et=(e,t,s,a)=>{for(let i=le.value.length-1;i>=0;i--){const c=le.value[i];if(c.life-=a,c.life<=0){le.value.splice(i,1);continue}c.x+=c.vx*a*.06,c.y+=c.vy*a*.06,c.z+=c.vz*a*.06,c.vz-=.02,c.z<0&&(c.z=0,c.vx*=.5,c.vy*=.5);const l=j(c.x,c.y,t,s),r=d.zoom,f=l.y-c.z*10*r;e.fillStyle=c.color;const n=Math.max(2,c.size*r);e.fillRect(l.x-n/2,f-n/2,n,n)}},tt=(e,t,s,a,i)=>{for(const l of t.events.attacks){const r=t.entities[l.attackerId],f=t.entities[l.targetId];if(!r||!f)continue;const n=j(r.x,r.y,s,a),M=j(f.x,f.y,s,a);n.y-=30*d.zoom,M.y-=30*d.zoom;const h=l.isCritical;if(i<.5){const g=i/.5,b=n.x+(M.x-n.x)*g,p=n.y+(M.y-n.y)*g,w=Math.sin(g*Math.PI)*40*d.zoom,S=8*d.zoom,v=b,u=p-w,x=e.createRadialGradient(v-S/3,u-S/3,S/6,v,u,S*1.2);h?(x.addColorStop(0,"#ffffff"),x.addColorStop(.2,"#fef3c7"),x.addColorStop(.5,"#fbbf24"),x.addColorStop(.8,"#d97706"),x.addColorStop(1,"rgba(180, 83, 9, 0)")):(x.addColorStop(0,"#ffffff"),x.addColorStop(.2,"#dbeafe"),x.addColorStop(.5,"#60a5fa"),x.addColorStop(.8,"#2563eb"),x.addColorStop(1,"rgba(30, 64, 175, 0)")),e.save(),e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=15*d.zoom,e.fillStyle=x,e.beginPath(),e.arc(v,u,S,0,Math.PI*2),e.fill(),e.restore();const m=e.createRadialGradient(v,u,0,v,u,S*.4);if(m.addColorStop(0,"rgba(255, 255, 255, 0.9)"),m.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=m,e.beginPath(),e.arc(v,u,S*.4,0,Math.PI*2),e.fill(),g>.1){const _=e.createLinearGradient(n.x,n.y,v,u);h?(_.addColorStop(0,"rgba(251, 191, 36, 0)"),_.addColorStop(.5,"rgba(251, 191, 36, 0.3)"),_.addColorStop(1,"rgba(251, 191, 36, 0.8)")):(_.addColorStop(0,"rgba(96, 165, 250, 0)"),_.addColorStop(.5,"rgba(96, 165, 250, 0.3)"),_.addColorStop(1,"rgba(96, 165, 250, 0.8)")),e.strokeStyle=_,e.lineWidth=3*d.zoom,e.lineCap="round",e.beginPath(),e.moveTo(n.x,n.y),e.quadraticCurveTo(n.x+(M.x-n.x)*.5,n.y+(M.y-n.y)*.5-40*d.zoom,v,u),e.stroke()}}if(i>=.5&&i<.5+.3){const g=(i-.5)/.3,b=M.x,p=M.y-20*d.zoom,w=(h?30:20)*d.zoom*(.3+g*.7),S=1-g;e.save(),e.globalAlpha=S;const v=e.createRadialGradient(b,p,w*.5,b,p,w);if(h?(v.addColorStop(0,"rgba(251, 191, 36, 0)"),v.addColorStop(.6,"rgba(251, 191, 36, 0.8)"),v.addColorStop(.8,"rgba(245, 158, 11, 0.6)"),v.addColorStop(1,"rgba(217, 119, 6, 0)")):(v.addColorStop(0,"rgba(96, 165, 250, 0)"),v.addColorStop(.6,"rgba(96, 165, 250, 0.8)"),v.addColorStop(.8,"rgba(59, 130, 246, 0.6)"),v.addColorStop(1,"rgba(37, 99, 235, 0)")),e.fillStyle=v,e.beginPath(),e.arc(b,p,w,0,Math.PI*2),e.fill(),g<.5){const m=1-g/.5,_=(h?15:10)*d.zoom*(1-g*.5);e.globalAlpha=m,e.shadowColor=h?"#fbbf24":"#60a5fa",e.shadowBlur=20*d.zoom;const E=e.createRadialGradient(b,p,0,b,p,_);E.addColorStop(0,"#ffffff"),E.addColorStop(.5,h?"#fef3c7":"#dbeafe"),E.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=E,e.beginPath(),e.arc(b,p,_,0,Math.PI*2),e.fill()}const u=h?8:5,x=(h?25:15)*d.zoom*(.5+g*.5);e.globalAlpha=S*.8,e.strokeStyle=h?"#fef3c7":"#dbeafe",e.lineWidth=2*d.zoom,e.lineCap="round";for(let m=0;m<u;m++){const _=Math.PI*2/u*m+g*.5,E=w*.3,y=E+x*(1-g*.5);e.beginPath(),e.moveTo(b+Math.cos(_)*E,p+Math.sin(_)*E),e.lineTo(b+Math.cos(_)*y,p+Math.sin(_)*y),e.stroke()}e.restore()}if(i>=.5){const g=(i-.5)/.5,b=Math.min(1,g*3),w=(1-Math.pow(1-b,3))*60*d.zoom,S=Math.max(0,1-g*1.5);e.save(),e.globalAlpha=S;const v=Math.round((l.isCritical?24:14)*d.zoom);e.font=`bold ${v}px 'Courier New', monospace`,e.textAlign="center";const u=`${l.damage}`,x=M.x,m=M.y-30*d.zoom-w;e.lineWidth=3,e.strokeStyle="black",e.strokeText(u,x,m),e.fillStyle=l.isCritical?"#fbbf24":"#fff",e.fillText(u,x,m),l.isCritical&&(e.font=`bold ${Math.round(10*d.zoom)}px 'Courier New', monospace`,e.fillStyle="#f59e0b",e.fillText("CRIT!",x,m-20*d.zoom)),e.restore()}}},st=e=>{if(!oe.value)return;const t=oe.value,s=t.getContext("2d");if(!s)return;const a=t.getBoundingClientRect();(t.width!==a.width||t.height!==a.height)&&(t.width=a.width,t.height=a.height),d.shakeX*=.9,d.shakeY*=.9,Math.abs(d.shakeX)<.5&&(d.shakeX=0),Math.abs(d.shakeY)<.5&&(d.shakeY=0);let i=C.value,c=0;if(N.value&&L>0){const p=1e3/F.value;c=Math.min(1,(e-L)/p)}const l=B.value[i];if(!l)return;const r=k.value.indexOf(i)+1,f=k.value[r],n=f?B.value[f]:void 0;s.clearRect(0,0,t.width,t.height);for(let p=0;p<=Ve;p++)for(let w=0;w<=Ve;w++)Ke(s,p,w,t.width,t.height);const M=ot(l,n,c),h=new Set,g=new Set;l.events?.attacks&&(c>=.5&&c<.5+.2&&l.events.attacks.forEach(w=>h.add(w.targetId)),c<.4&&l.events.attacks.forEach(w=>g.add(w.attackerId)));const b=Object.values(M).map(p=>({type:"entity",yDepth:p.x+p.y,entity:p,x:p.x,y:p.y,hit:h.has(p.id),attacking:g.has(p.id)}));b.sort((p,w)=>p.yDepth-w.yDepth);for(const p of b)p.type==="entity"&&Qe(s,p.entity,p.x,p.y,t.width,t.height,e,{hit:p.hit,attacking:p.attacking});et(s,t.width,t.height,16),tt(s,l,t.width,t.height,c)},ot=(e,t,s)=>{if(!t||s<=0)return e.entities;const a={};return new Set([...Object.keys(e.entities),...Object.keys(t.entities)]).forEach(c=>{const l=e.entities[c],r=t.entities[c];if(l&&r){const f=r.x-l.x,n=r.y-l.y,M=s<1&&(Math.abs(f)>.001||Math.abs(n)>.001);a[c]={...l,x:l.x+f*s,y:l.y+n*s,hp:l.hp+(r.hp-l.hp)*s,alive:s<.8?l.alive:r.alive,floatOffset:l.floatOffset,vx:f,vy:n,isMoving:M}}else r?a[c]={...r,isMoving:!1,vx:0,vy:0}:l&&(a[c]={...l,isMoving:!1,vx:0,vy:0})}),a},ke=e=>{if(st(e),N.value){L||(L=e);const t=1e3/F.value,s=(e-L)/t;if(s>.1&&s<.15&&B.value[C.value]?.events.attacks.some(i=>i.isCritical)&&Be(2*d.zoom),s>=1){const i=k.value.indexOf(C.value)+1;i>=k.value.length?(N.value=!1,L=0):(C.value=k.value[i],L=e,Q(C.value))}}K=requestAnimationFrame(ke)},Ce=e=>{const t=k.value.indexOf(C.value);if(t===-1)return;const s=t+e;s<0||s>=k.value.length||(C.value=k.value[s],Q(C.value))},Q=e=>{xt(()=>{const t=document.getElementById("log-round-"+e);if(t&&Z.value){const s=t.offsetTop-Z.value.offsetTop;Z.value.scrollTo({top:s-100,behavior:"smooth"})}})},at=e=>{if(!k.value.length)return;const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left,a=Math.max(0,Math.min(1,s/t.width)),i=Math.floor(a*(k.value.length-1));C.value=k.value[i],Q(C.value)},lt=e=>{C.value=e,N.value=!1},nt=()=>{k.value.length<=1||(N.value?N.value=!1:(C.value===k.value[k.value.length-1]&&(C.value=k.value[0]),N.value=!0,L=0))},Me=async()=>{if(!(!q.token||!$.value)){se.value=!0;try{const t=await Xe(`${De.match}/${$.value}/roundticks`,{token:q.token})||[],s=D.value.length;if(D.value=t,rt(),A.value==="running"&&t.length>s&&t.length>0){const a=t[t.length-1]?.round;a!=null&&(C.value=a,Q(a))}}catch(e){console.error(e)}finally{se.value=!1}}},Se=async()=>{if(!(!q.token||!$.value))try{const e=await Xe(`${De.match}/${$.value}`,{token:q.token});return A.value=e?.status??null,e?.status}catch{return A.value=null,null}},rt=()=>{const e=new Set(ye.fighters.map(a=>a.id)),t=new Map,s={};for(const a of D.value){const i={attacks:[],deaths:[]};for(const l of a.ticks||[]){const r=l.payload;if(r){if(l.type==="spawn"){const f=r.fighterId;t.set(f,{id:f,x:r.x??0,y:r.y??0,hp:r.hp??100,maxHp:r.hp??100,alive:!0,isPlayer:e.has(f),floatOffset:Math.random()*Math.PI*2})}else if(l.type==="move"){const f=r.fighterId,n=t.get(f);n&&(n.x=r.toX??n.x,n.y=r.toY??n.y)}else if(l.type==="attack"){i.attacks.push({attackerId:r.attackerId,targetId:r.targetId,isCritical:r.isCritical,isParried:r.isParried,damage:r.damage});const f=t.get(r.targetId);f&&(f.hp=Math.max(0,f.hp-(r.damage||0)))}else if(l.type==="died"){const f=r.fighterId,n=t.get(f);n&&(n.alive=!1,n.hp=0),i.deaths.push(f)}}}const c={};t.forEach((l,r)=>{c[r]={...l}}),s[a.round]={round:a.round,entities:c,events:i}}B.value=s};function it(){W||(W=window.setInterval(async()=>{const e=await Se();await Me(),e==="completed"&&Ie()},2500))}function Ie(){W&&(clearInterval(W),W=null)}return pt(async()=>{await ye.fetchFighters(),He(),await Se(),await Me(),k.value.length&&(A.value==="completed"?C.value=k.value[0]:C.value=k.value[k.value.length-1]),K=requestAnimationFrame(ke),A.value==="running"&&it()}),ut(()=>{K&&cancelAnimationFrame(K),Ie()}),(e,t)=>(T(),z("div",{class:"pixel-theme h-dvh max-h-dvh overflow-hidden flex flex-col gap-3 sm:gap-4 font-mono text-slate-200",style:me({backgroundImage:`url('${V.BG_DUNGEON}')`})},[t[29]||(t[29]=o("div",{class:"fixed inset-0 bg-slate-950/80 pointer-events-none z-0"},null,-1)),o("header",Ct,[o("div",Mt,[Ae(_t,{variant:"ghost",size:"sm",onClick:t[0]||(t[0]=s=>e.$router.push("/matches")),"class-name":"rpg-btn-small"},{default:Ne(()=>[...t[6]||(t[6]=[ge(" ← BACK ",-1)])]),_:1}),o("div",null,[o("h1",St,[ge(" BATTLE LOG #"+O($.value?.substring(0,8))+" ",1),A.value?(T(),z("span",{key:0,class:be(["px-2 py-0.5 text-xs font-bold uppercase tracking-wider border-2",$e.value])},O(A.value),3)):X("",!0)])])]),A.value==="running"?(T(),z("div",It,[...t[7]||(t[7]=[o("span",{class:"relative flex h-2 w-2"},[o("span",{class:"animate-ping absolute inline-flex h-full w-full bg-amber-400 opacity-75"}),o("span",{class:"relative inline-flex h-2 w-2 bg-amber-500"})],-1),o("span",{class:"text-xs font-bold text-amber-400 uppercase tracking-widest blink"},"LIVE FEED",-1)])])):X("",!0)]),o("div",Tt,[o("div",zt,[o("div",Pt,[se.value?(T(),z("div",Ot,[...t[8]||(t[8]=[o("div",{class:"flex flex-col items-center gap-3"},[o("div",{class:"h-8 w-8 animate-spin border-4 border-amber-500 border-t-transparent"}),o("p",{class:"text-amber-200 text-sm font-bold uppercase tracking-wider"},"Loading battle data...")],-1)])])):D.value.length?X("",!0):(T(),z("div",Et,[...t[9]||(t[9]=[o("p",{class:"text-slate-500 font-bold uppercase tracking-wider"},"Waiting for battle data...",-1)])])),o("canvas",{ref_key:"canvasRef",ref:oe,class:"w-full h-full object-cover cursor-move pixelated",onMousedown:Fe,onMousemove:Ue,onMouseup:_e,onMouseleave:_e,onWheel:ht(qe,["prevent"])},null,544),t[14]||(t[14]=o("div",{class:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"},null,-1)),t[15]||(t[15]=o("div",{class:"absolute inset-0 pointer-events-none opacity-10 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-size-[100%_4px]"},null,-1)),Ae(gt,{name:"fade"},{default:Ne(()=>[A.value==="completed"&&k.value.length&&C.value===k.value[k.value.length-1]?(T(),z("div",Rt,[o("div",At,[o("img",{src:V.ICON_TROPHY,class:"w-16 h-16 mx-auto mb-4 pixelated animate-bounce-slow"},null,8,Nt),t[10]||(t[10]=o("h2",{class:"text-4xl font-black text-amber-500 tracking-widest uppercase text-shadow-retro"},"VICTORY",-1)),t[11]||(t[11]=o("p",{class:"text-amber-200 mt-2 font-bold text-sm tracking-wide uppercase"},"Quest Complete",-1))])])):X("",!0)]),_:1}),o("div",Lt,[o("div",{class:"relative h-4 bg-slate-950 border-2 border-slate-700 cursor-pointer group/bar",onClick:at},[o("div",{class:"absolute inset-y-0 left-0 bg-amber-600 transition-all duration-100",style:me({width:we.value+"%"})},null,4),o("div",{class:"absolute inset-y-0 w-2 bg-white opacity-0 group-hover/bar:opacity-100 transition-opacity",style:me({left:we.value+"%"})},null,4)]),o("div",Yt,[o("div",Xt,[o("button",{onClick:nt,class:"rpg-btn-small bg-amber-600 border-amber-800 text-slate-900 hover:bg-amber-500 font-black h-10 w-10 flex items-center justify-center"},[N.value?(T(),z("span",Dt,"||")):(T(),z("span",Gt,">"))]),o("div",Vt,[o("button",{onClick:t[1]||(t[1]=s=>Ce(-1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},"<<"),o("span",jt,"RND "+O(C.value),1),o("button",{onClick:t[2]||(t[2]=s=>Ce(1)),class:"p-1 text-slate-400 hover:text-white transition-colors active:scale-90 font-bold"},">>")])]),o("div",Ht,[o("div",$t,[t[12]||(t[12]=o("span",{class:"uppercase font-bold"},"SPD",-1)),bt(o("input",{type:"range",min:"0.5",max:"4",step:"0.5","onUpdate:modelValue":t[3]||(t[3]=s=>F.value=s),class:"w-20 accent-amber-500 h-2 bg-slate-800 appearance-none cursor-pointer"},null,512),[[mt,F.value,void 0,{number:!0}]]),o("span",Wt,O(F.value)+"x",1)]),o("div",Bt,[t[13]||(t[13]=o("span",{class:"uppercase font-bold"},"ZM",-1)),o("button",{onClick:t[4]||(t[4]=s=>re(-.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"-"),o("span",Ft,O(Math.round(d.zoom*100))+"%",1),o("button",{onClick:t[5]||(t[5]=s=>re(.1)),class:"px-1.5 hover:text-white font-bold text-lg leading-none"},"+")])])])])]),o("div",Ut,[o("div",qt,[o("img",{src:V.ICON_SWORD,class:"w-4 h-4 pixelated"},null,8,Kt),t[16]||(t[16]=o("span",{class:"font-bold text-emerald-200 uppercase"},"Heroes",-1))]),o("div",Zt,[o("img",{src:V.ICON_SKULL,class:"w-4 h-4 pixelated"},null,8,Jt),t[17]||(t[17]=o("span",{class:"font-bold text-rose-200 uppercase"},"Enemies",-1))]),t[23]||(t[23]=o("div",{class:"flex-1 hidden sm:block"},null,-1)),o("div",Qt,[o("div",es,[t[18]||(t[18]=o("span",{class:"text-slate-500 font-bold uppercase"},"TOTAL",-1)),o("span",ts,O(ne.value.total),1)]),t[21]||(t[21]=o("div",{class:"w-px h-6 bg-slate-700"},null,-1)),o("div",ss,[t[19]||(t[19]=o("span",{class:"text-emerald-500/70 font-bold uppercase"},"ALIVE",-1)),o("span",os,O(ne.value.alive),1)]),t[22]||(t[22]=o("div",{class:"w-px h-6 bg-slate-700"},null,-1)),o("div",as,[t[20]||(t[20]=o("span",{class:"text-rose-500/70 font-bold uppercase"},"FALLEN",-1)),o("span",ls,O(ne.value.fallen),1)])])])]),o("div",ns,[o("div",rs,[t[24]||(t[24]=o("h3",{class:"font-bold text-amber-500 text-sm uppercase tracking-wider flex items-center gap-2"},[o("span",{class:"w-2 h-2 bg-amber-500 animate-pulse"}),ge(" Combat Log ")],-1)),o("span",is,O(D.value.length)+" TICKS",1)]),o("div",{class:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar scroll-smooth bg-[#020617]",ref_key:"logsContainer",ref:Z},[(T(!0),z(Le,null,Ye(D.value,s=>(T(),z("div",{key:s.round,id:"log-round-"+s.round,onClick:a=>lt(s.round),class:be(["border-2 p-3 text-xs transition-all cursor-pointer group relative overflow-hidden",s.round===C.value?"border-amber-600 bg-amber-900/20":"border-slate-800 hover:border-slate-600 hover:bg-slate-900"])},[s.round===C.value?(T(),z("div",cs)):X("",!0),o("div",fs,[o("span",ps,"ROUND "+O(s.round.toString().padStart(2,"0")),1),s.ticks?.length?(T(),z("span",us,O(s.ticks.length)+" EVENTS",1)):X("",!0)]),o("div",hs,[(T(!0),z(Le,null,Ye(s.ticks,(a,i)=>(T(),z("div",{key:i,class:"pl-3 border-l-2 border-slate-800 py-0.5 relative"},[t[28]||(t[28]=o("div",{class:"absolute -left-[5px] top-2 w-[8px] h-[8px] bg-slate-800 border border-slate-600 rotate-45"},null,-1)),a.type==="attack"?(T(),z("div",gs,[o("span",bs,O(J(G(a.payload,"attackerId"))),1),t[25]||(t[25]=o("span",{class:"text-slate-600 text-[10px] uppercase font-bold tracking-wider"},"HIT",-1)),o("span",ms,O(J(G(a.payload,"targetId"))),1),o("span",{class:be(["font-mono font-bold ml-1",G(a.payload,"isCritical")?"text-amber-400 text-sm":"text-slate-300"])}," -"+O(G(a.payload,"damage")),3),G(a.payload,"isCritical")?(T(),z("span",vs,"CRIT")):X("",!0)])):a.type==="died"?(T(),z("div",ys,[t[27]||(t[27]=o("span",{class:"text-rose-500 text-lg"},"☠",-1)),o("div",xs,[t[26]||(t[26]=o("span",{class:"text-rose-500 font-bold uppercase text-[10px] tracking-wide"},"SLAIN",-1)),o("span",ws,O(J(G(a.payload,"fighterId"))),1)])])):a.type==="spawn"?(T(),z("div",_s," ✨ "+O(J(G(a.payload,"fighterId")))+" APPEARED ",1)):X("",!0)]))),128))])],10,ds))),128))],512)])])],4))}}),Ts=wt(ks,[["__scopeId","data-v-3f683f45"]]);export{Ts as default};
